webpackJsonp([107],{SwR0:function(e,t){},q4uX:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("mvHQ"),i=a.n(l),r=a("FMx0"),s=a("DAYN"),o=a.n(s),n=a("yPE/"),c=a.n(n),d=a("UU1J"),u=a("5fic"),m=a("V3Ru"),f=a("0xDb"),p=a.n(f),h={components:{draggable:o.a,vBreadcrumb:r.a,icon:d.a},data:function(){return{nav:["运营管理","营销工具管理","优惠套餐","新建套餐"],isUseUpload:!1,uploadImg:"",imgArr:[],showSaleTime:!1,showDealTime:!1,itemList:[],brandArr:[],itemProps:{value:"value",children:"children"},proItemArr:[],freightTemplateArr:[],supplierArr:[],shipperArr:[{label:"平台发货",value:"1"},{label:"供应商发货",value:"2"}],aferServiceDays:[{label:"无售后服务",value:"0"},{label:"到货后7天",value:"7"},{label:"到货后15天",value:"15"},{label:"到货后30天",value:"30"},{label:"到货后6个月",value:"180"},{label:"到货后1年",value:"365"},{label:"到货后2年",value:"730"},{label:"到货后3年",value:"1095"}],times:[{label:"7天",id:"7"},{label:"10天",id:"10"},{label:"15天",id:"15"},{label:"20天",id:"20"},{label:"25天",id:"25"},{label:"30天",id:"30"}],specArr:[],form:{name:"",firstCategoryId:"",secCategoryId:"",brandId:"",supplierId:"",sendfrom:"",weight:"",freightTemplateId:"",aferServiceDays:"",dealDays:"",content:"",tagStr:"",originalImgStr:"",smallImgStr:""},editorOption:{placeholder:"请输入内容",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image"]]}},uploadData:{},uploadType:"",selectedTagArr:[],tagArr:[],tagName:"",btnLoading:!1}},computed:{qnLocation:function(){return location.protocol,u.a}},activated:function(){this.uploadImg=u.a,this.imgArr=[],this.proItemArr=[],this.selectedTagArr=[],this.getFirstItem(),this.getFreightTemplate(),this.getAllTags(),p.a.cleanFormData(this.form)},mounted:function(){this.$refs.myQuillEditor.quill.getModule("toolbar").addHandler("image",this.imgHandler)},methods:{beforeSubmit:function(){return/^[\da-zA-Z_\u4e00-\u9f5a]{4,16}$/.test(this.form.name)?0==this.imgArr.length?(this.$message.warning("请添加产品图片"),!1):0==this.selectedTagArr.length?(this.$message.warning("请添加产品标签"),!1):parseInt(this.form.weight)>=0||(this.$message.warning("请输入正确的重量"),!1):(this.$message.warning("套餐名称不符合规则!"),!1)},submitForm:function(){var e=this;if(this.beforeSubmit()){var t=[],a=[],l=[];this.selectedTagArr.forEach(function(e,a){t.push(e.value)}),this.form.tagStr=t.join(","),this.imgArr.forEach(function(e,t){a.push(e.smallUrl),l.push(e.originUrl)});var r=[];this.specArr.forEach(function(e,t){e.parmValue&&r.push({parmId:e.id,parmValue:e.parmValue})}),this.form.specStr=i()(r),this.form.smallImgStr=a.join(","),this.form.originalImgStr=l.join(",");var s={};(s=this.form).url=m.addOperActivityPackage,this.btnLoading=!0,this.$axios.post(u.b,s).then(function(t){e.$message.success(t.data.msg),e.$router.push("/packageList"),e.btnLoading=!1}).catch(function(t){console.log(t),e.btnLoading=!1})}},beforeUploadArr:function(){this.$message.warning("上传中...")},getdata:function(e){},datadragEnd:function(e){},successUpload:function(e){if(200==e.code){if(this.imgArr.length>=5)return this.isUseUpload=!0,void this.$message.warning("最多只能上传五张图片");this.imgArr.push({originUrl:e.data.imageUrl,smallUrl:e.data.imageThumbUrl}),this.$message.success("上传成功")}else this.$message.warning(e.data.msg)},deleteImg:function(e){var t=-1;this.imgArr.forEach(function(a,l){a.originUrl==e.originUrl&&(t=l)}),-1!=t&&(this.imgArr.splice(t,1),this.imgArr.length<5&&(this.isUseUpload=!1))},defSaleTime:function(){this.form.aferServiceDays="",this.showSaleTime=!this.showSaleTime},defDealTime:function(){this.form.dealDays="",this.showDealTime=!this.showDealTime},onEditorChange:function(e){e.editor;var t=e.html;e.text;this.form.content=t},upScuccess:function(e,t,a){this.fullscreenLoading=!1;var l=this,i="";if("image"===this.uploadType&&(i=e.data.imageUrl),null!=i&&i.length>0){var r=i;l.addRange=l.$refs.myQuillEditor.quill.getSelection(),r=-1!==r.indexOf("http")?r:"http:"+r,l.$refs.myQuillEditor.quill.insertEmbed(null!==l.addRange?l.addRange.index:0,l.uploadType,r,c.a.sources.USER),this.$message.success("插入成功")}else this.$message.error(l.uploadType+"插入失败");this.$refs.upload.clearFiles()},imgHandler:function(e){(this.addRange=this.$refs.myQuillEditor.quill.getSelection(),e)&&document.getElementById("imgInput").click();this.uploadType="image"},handleClose:function(e,t){var a=this;this.selectedTagArr.splice(e,1),this.tagArr.forEach(function(e,l){t.label==e.label&&(a.tagArr[l].selected=!1)})},addTag:function(){var e=this;if(""!=this.tagName){var t=!1;if(this.tagArr.forEach(function(a,l){e.tagName==a.label&&(t=!0)}),t)this.$message.warning("标签已经添加，请不要重复添加!");else{var a={};a.name=this.tagName,a.url=m.addOperActivityPackage,a.type=2,this.$axios.post(u.e,a).then(function(t){e.$message.success("添加成功!"),e.tagName="",e.getAllTags()}).catch(function(e){console.log(e)})}}else this.$message.warning("请输入正确的标签")},insertTag:function(e){this.selectedTagArr.length>19?this.$message.warning("最多添加20个标签"):(e.selected=!0,this.selectedTagArr.push({label:e.label,value:e.value}))},getFirstItem:function(){var e=this;this.itemList=[],this.$axios.post(u.j,{fatherid:0,type:2,url:m.addOperActivityPackage,pageSize:1e4}).then(function(t){t.data.data.data.forEach(function(t,a){e.itemList.push({label:t.name,value:t.id,children:[]}),e.handleItemChange(t.id)})}).catch(function(e){console.log(e)})},handleItemChange:function(e){var t=this,a=0;this.itemList.forEach(function(t,l){t.value==e&&(a=l)});var l={};l.fatherid=e,l.type=2,l.url=m.addOperActivityPackage,l.pageSize=1e4,this.itemList[a].children=[],this.$axios.post(u.j,l).then(function(e){e.data.data.data.forEach(function(e,l){t.itemList[a].children.push({label:e.name,value:e.id})})}).catch(function(e){console.log(e)})},getProItemId:function(e){var t=this;this.form.brandId="";var a=this.form.secCategoryId=e[1];this.form.firstCategoryId=e[0],this.form.secCategoryId=e[1],this.brandArr=[],this.specArr=[],this.$axios.post(u.s,{cId:a,url:m.addOperActivityPackage,pageSize:1e4}).then(function(e){e.data.data.forEach(function(e,a){t.brandArr.push({label:e.name,value:e.id})})}).catch(function(e){console.log(e)}),this.$axios.post(u.m,{categoryId:a}).then(function(e){t.specArr=e.data.data}).catch(function(e){console.log(e)})},getSupplyList:function(){var e=this;this.supplierId="";var t={};this.supplierArr=[],t.firstCategoryId=this.form.firstCategoryId,t.secCategoryId=this.form.secCategoryId,t.brandId=this.form.brandId,t.url=m.addOperActivityPackage,this.$axios.post(u.B,t).then(function(t){t.data.data.forEach(function(t,a){e.supplierArr.push({label:t.name,value:t.supplier_id})})}).catch(function(e){console.log(e)})},getFreightTemplate:function(){var e=this;this.freightTemplateArr=[],this.$axios.post(u.l,{url:m.addOperActivityPackage}).then(function(t){t.data.data.forEach(function(t,a){e.freightTemplateArr.push({label:t.name,value:t.id})})}).catch(function(e){console.log(e)})},getAllTags:function(){var e=this;this.tagArr=[],this.$axios.post(u.C,{type:2,url:m.addOperActivityPackage}).then(function(t){t.data.data.forEach(function(t,a){e.tagArr.push({label:t.name,value:t.id})}),e.tagArr.forEach(function(t,a){e.selectedTagArr.forEach(function(e,a){t.value==e.value&&(t.selected=!0)})})}).catch(function(e){console.log(e)})},backToList:function(){this.$router.push("/packageList")}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-package"},[a("v-breadcrumb",{attrs:{nav:e.nav}}),e._v(" "),a("el-card",{attrs:{"body-style":{padding:"20px 45px",color:"#666"}}},[a("div",{staticClass:"pro-title"},[e._v("基本信息")]),e._v(" "),a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"套餐名称"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入套餐名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),e._v(" "),a("span",{staticClass:"upload-tip"},[e._v("规则:4~16位汉字、字母、下划线的组合")])],1),e._v(" "),a("el-form-item",{attrs:{label:"产品图片"}},[a("draggable",{staticStyle:{display:"inline-block"},attrs:{move:e.getdata},on:{update:e.datadragEnd},model:{value:e.imgArr,callback:function(t){e.imgArr=t},expression:"imgArr"}},[a("transition-group",e._l(e.imgArr,function(t,l){return a("div",{key:l,staticClass:"img-wrap"},[a("div",{staticClass:"delImg",on:{click:function(a){e.deleteImg(t)}}},[a("icon",{attrs:{ico:"icon-shanchu"}})],1),e._v(" "),a("img",{staticClass:"uImg",attrs:{src:t.originUrl}})])}))],1),e._v(" "),a("el-upload",{staticClass:"img-uploader",attrs:{"before-upload":e.beforeUploadArr,action:e.uploadImg,"show-file-list":!1,"on-success":e.successUpload,disabled:e.isUseUpload,multiple:""}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),a("div",{staticClass:"upload-tip"},[e._v("建议尺寸：800*800,拖拽图片可以改变顺序，第一张为默认头图")])],1),e._v(" "),a("el-form-item",{attrs:{label:"产品分类"}},[a("el-cascader",{attrs:{filterable:"",options:e.itemList,props:e.itemProps},on:{change:e.getProItemId},model:{value:e.proItemArr,callback:function(t){e.proItemArr=t},expression:"proItemArr"}}),e._v(" "),a("span",{staticStyle:{"margin-left":"30px"}},[e._v("产品品牌")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.getSupplyList},model:{value:e.form.brandId,callback:function(t){e.$set(e.form,"brandId",t)},expression:"form.brandId"}},e._l(e.brandArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"供应商"}},[a("el-select",{attrs:{placeholder:"下拉搜索供应商"},model:{value:e.form.supplierId,callback:function(t){e.$set(e.form,"supplierId",t)},expression:"form.supplierId"}},e._l(e.supplierArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"发货方"}},[a("el-select",{attrs:{placeholder:"选择发货方"},model:{value:e.form.sendfrom,callback:function(t){e.$set(e.form,"sendfrom",t)},expression:"form.sendfrom"}},e._l(e.shipperArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"产品重量"}},[a("el-input",{staticClass:"pro-weight",model:{value:e.form.weight,callback:function(t){e.$set(e.form,"weight",t)},expression:"form.weight"}}),e._v("\n                kg\n            ")],1),e._v(" "),a("el-form-item",{attrs:{label:"产品参数"}},[a("div",{staticClass:"product-param"},[e._l(e.specArr,function(t,l){return[a("span",[e._v(e._s(t.parm))]),e._v(" "),a("el-input",{staticClass:"inp-param",model:{value:t.parmValue,callback:function(a){e.$set(t,"parmValue",a)},expression:"v.parmValue"}})]})],2)]),e._v(" "),a("div",{staticClass:"pro-title"},[e._v("运费信息")]),e._v(" "),a("el-form-item",{attrs:{label:"选择运费模板"}},[a("el-select",{attrs:{placeholder:"请选择模板"},model:{value:e.form.freightTemplateId,callback:function(t){e.$set(e.form,"freightTemplateId",t)},expression:"form.freightTemplateId"}},e._l(e.freightTemplateArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"售后周期"}},[a("transition",{attrs:{name:"fade"}},[e.showSaleTime?e._e():a("el-select",{attrs:{placeholder:"请选择售后周期"},model:{value:e.form.aferServiceDays,callback:function(t){e.$set(e.form,"aferServiceDays",t)},expression:"form.aferServiceDays"}},e._l(e.aferServiceDays,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),e._v(" "),e.showSaleTime?a("el-input",{staticStyle:{width:"215px"},attrs:{placeholder:"请输入售后周期"},model:{value:e.form.aferServiceDays,callback:function(t){e.$set(e.form,"aferServiceDays",t)},expression:"form.aferServiceDays"}}):e._e()],1),e._v(" "),a("el-button",{on:{click:e.defSaleTime}},[e._v("自定义")])],1),e._v(" "),a("el-form-item",{attrs:{label:"交易默认时间"}},[a("transition",{attrs:{name:"fade"}},[e.showDealTime?e._e():a("el-select",{attrs:{placeholder:"请选择交易默认时间"},model:{value:e.form.dealDays,callback:function(t){e.$set(e.form,"dealDays",t)},expression:"form.dealDays"}},e._l(e.times,function(t,l){return a("el-option",{key:l,attrs:{label:t.label,value:t.id}},[e._v("\n                            "+e._s(t.label)+"\n                        ")])})),e._v(" "),e.showDealTime?a("el-input",{staticStyle:{width:"215px"},attrs:{placeholder:"请输入交易默认时间"},model:{value:e.form.dealDays,callback:function(t){e.$set(e.form,"dealDays",t)},expression:"form.dealDays"}}):e._e()],1),e._v(" "),a("el-button",{on:{click:e.defDealTime}},[e._v("自定义")])],1),e._v(" "),a("div",{staticClass:"pro-title"},[e._v("产品详情")]),e._v(" "),a("quill-editor",{ref:"myQuillEditor",attrs:{options:e.editorOption},on:{change:function(t){e.onEditorChange(t)}},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}}),e._v(" "),a("el-upload",{ref:"upload",staticStyle:{display:"none"},attrs:{action:e.qnLocation,data:e.uploadData,"on-success":e.upScuccess}},[a("el-button",{attrs:{size:"small",type:"primary",id:"imgInput","element-loading-text":"插入中,请稍候"}},[e._v("点击上传")])],1),e._v(" "),a("div",{staticClass:"selected-tag"},[0==e.selectedTagArr.length?a("span",{staticClass:"tag-tip"},[e._v("请选择标签")]):e._e(),e._v(" "),e._l(e.selectedTagArr,function(t,l){return a("el-tag",{key:l,staticClass:"tag",attrs:{type:"info",closable:""},on:{close:function(a){e.handleClose(l,t)}}},[e._v(e._s(t.label)+"\n                ")])})],2),e._v(" "),a("div",{staticClass:"add-tag"},[a("el-input",{staticStyle:{width:"215px","margin-right":"20px"},attrs:{placeholder:"请输入标签/至多可添加20个"},model:{value:e.tagName,callback:function(t){e.tagName=t},expression:"tagName"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addTag}},[e._v("添加标签")])],1),e._v(" "),a("div",{staticClass:"tag-list"},[0==e.tagArr.length?a("span",{staticClass:"tag-tip"},[e._v("请添加标签")]):e._e(),e._v(" "),e._l(e.tagArr,function(t,l){return a("el-button",{key:l,class:{"selected-btn":t.selected},staticStyle:{"margin-bottom":"10px"},attrs:{disabled:t.selected},on:{click:function(a){e.insertTag(t)}}},[e._v(e._s(t.label)+"\n                ")])})],2),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:e.submitForm}},[e._v("提交")]),e._v(" "),a("el-button",[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var v=a("VU/8")(h,g,!1,function(e){a("SwR0")},null,null);t.default=v.exports}});