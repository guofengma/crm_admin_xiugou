webpackJsonp([154],{"Z+N1":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),r=a("FMx0"),l=a("DAYN"),o=a.n(l),n=a("yPE/"),c=a.n(n),d=a("UU1J"),m=a("9Vdu"),h=a("4cBs"),u=a("0xDb"),g=a.n(u),f={components:{draggable:o.a,vBreadcrumb:r.a,icon:d.a},data:function(){return{nav:["品牌产品管理","礼包管理","编辑礼包"],isUseUpload:!1,showSaleTime:!1,giftId:"",uploadImg:"",imgArr:[],imgSmallArr:[],supplierList:[],proItemArr:[],brandArr:[],freightTemplateArr:[],shipperArr:[{label:"平台发货",value:"1"},{label:"供应商发货",value:"2"}],times:[{label:"7天",id:"7"},{label:"10天",id:"10"},{label:"15天",id:"15"},{label:"20天",id:"20"},{label:"25天",id:"25"},{label:"30天",id:"30"}],checkAll:!1,checkedUsers:[],users:[],itemList:[],isIndeterminate:!1,productParm:[],form:{name:"",firstCategoryId:"",secCategoryId:"",brandId:"",supplier:"",originAddress:"",weight:"",freightTpl:"",saleTime:"",editorContent:"",pushWay:"",tagStr:"",imgStr:"",imgSmallStr:""},itemProps:{value:"value",children:"children"},editorOption:{placeholder:"请输入内容",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image"]]}},uploadData:{},uploadType:"",tagArr:[],selectedTagArr:[],tagName:""}},computed:{qnLocation:function(){return location.protocol,m.c}},activated:function(){this.uploadImg=m.c,this.giftId=this.$route.query.giftId||sessionStorage.getItem("giftId"),this.imgArr=[],this.imgSmallArr=[],this.selectedTagArr=[],this.checkedUsers=[],this.isIndeterminate=!1,g.a.cleanFormData(this.form),this.getFirstItem(),this.getFreightTemplate(),this.getGiftInfo()},mounted:function(){this.$refs.myQuillEditor.quill.getModule("toolbar").addHandler("image",this.imgHandler)},methods:{getGiftInfo:function(){var e=this;this.$axios.post(m.j,{id:this.giftId}).then(function(t){e.form.name=t.data.data.name,e.form.firstCategoryId=t.data.data.firstCategoryId,e.form.secCategoryId=t.data.data.secCategoryId,e.proItemArr.push(e.form.firstCategoryId),e.proItemArr.push(e.form.secCategoryId),e.getProItemId(e.proItemArr,!0),e.form.brandId=t.data.data.brandId,e.getSupplyList(),e.form.supplier=t.data.data.supplierId,e.form.originAddress=t.data.data.sendfrom.toString(),e.form.weight=t.data.data.weight,e.form.freightTpl=t.data.data.freightTemplateId,e.form.saleTime=t.data.data.aferServiceDays.toString(),e.form.editorContent=t.data.data.content,e.form.pushWay=t.data.data.buyer.join(","),e.productParm=t.data.data.paramList,e.selectedTagArr=[],t.data.data.tagList.forEach(function(t,a){var i={label:""};i.value=t,e.selectedTagArr.push(i)}),e.getAllTags(),e.checkedUsers=t.data.data.buyer,e.checkedUsers.length==e.users.length?(e.isIndeterminate=!1,e.checkAll=!0):(e.isIndeterminate=!0,e.checkAll=!1),e.imgArr=[],e.imgSmallArr=[],t.data.data.imgList.forEach(function(t,a){e.imgArr.push(t.original_img),e.imgSmallArr.push(t.small_img)}),e.getLevelList()})},submitForm:function(){var e=this,t=[];for(var a in this.selectedTagArr.forEach(function(e,a){t.push(e.value)}),this.form.tagStr=t.join(","),this.form.imgStr=this.imgArr.join(","),this.form.imgSmallStr=this.imgSmallArr.join(","),this.form)if(""==this.form[a])return this.$message.warning("礼包参数不能为空，请输入完整参数"),void console.log(this.form);if(0!=this.productParm.length){var i={};if(this.form.name.length<4)this.$message.warning("礼包名称不能少于四位");else{i.id=this.giftId,i.giftName=this.form.name,i.classifyId=this.form.firstCategoryId,i.secCategoryId=this.form.secCategoryId,i.brandId=this.form.brandId,i.supplierId=this.form.supplier,i.shipperId=this.form.originAddress,i.weight=this.form.weight,i.freightId=this.form.freightTpl,i.afterSaleDays=this.form.saleTime,i.details=this.form.editorContent,i.roleStr=this.form.pushWay,i.tagStr=this.form.tagStr,i.originalImgStr=this.form.imgStr,i.smallImgStr=this.form.imgSmallStr;var r=[];this.productParm.forEach(function(e,t){r.push({paramId:e.paramId,value:e.paramValue})}),i.specStr=s()(r),this.$axios.post(m.D,i).then(function(t){e.$message.success(t.data.msg),e.$router.push("giftManage")})}}else this.$message.warning("礼包参数不能为空，请输入完整参数")},getdata:function(e){},datadragEnd:function(e){},successUpload:function(e){if(this.$message.warning("上传中..."),200==e.code){if(this.imgArr.length>=5)return this.isUseUpload=!0,void this.$message.warning("最多只能上传五张图片");this.imgArr.push(e.data.imageUrl),this.imgSmallArr.push(e.data.imageThumbUrl),this.$message.success("上传成功")}else this.$message.warning(e.data.msg)},deleteImg:function(e){var t=this.imgArr.indexOf(e);-1!=t&&(this.imgArr.splice(t,1),this.imgSmallArr.splice(t,1),this.imgArr.length<5&&(this.isUseUpload=!1))},defSaleTime:function(){this.form.saleTime="",this.showSaleTime=!this.showSaleTime},onEditorChange:function(e){e.editor;var t=e.html;e.text;this.form.editorContent=t},upScuccess:function(e,t,a){this.fullscreenLoading=!1;var i=this,s="";if("image"===this.uploadType&&(s=e.data.imageUrl,this.form.original_img=e.data.imageUrl,this.form.small_img=e.data.imageThumbUrl),null!=s&&s.length>0){var r=s;i.addRange=i.$refs.myQuillEditor.quill.getSelection(),r=-1!==r.indexOf("http")?r:"http:"+r,i.$refs.myQuillEditor.quill.insertEmbed(null!==i.addRange?i.addRange.index:0,i.uploadType,r,c.a.sources.USER),this.$message.success("插入成功")}else this.$message.error(i.uploadType+"插入失败");this.$refs.upload.clearFiles()},imgHandler:function(e){(this.addRange=this.$refs.myQuillEditor.quill.getSelection(),e)&&document.getElementById("imgInput").click();this.uploadType="image"},handleClose:function(e,t){var a=this;this.selectedTagArr.splice(e,1),this.tagArr.forEach(function(e,i){t.label==e.label&&(a.tagArr[i].selected=!1)})},addTag:function(){var e=this;if(""!=this.tagName){var t=!1;if(this.tagArr.forEach(function(a,i){e.tagName==a.label&&(t=!0)}),t)this.$message.warning("标签已经添加，请不要重复添加!");else{var a={};a.name=this.tagName,a.url=h.a,a.type=2,this.$axios.post(m.d,a).then(function(t){e.$message.success("添加成功!"),e.tagName="",e.getAllTags()}).catch(function(e){console.log(e)})}}else this.$message.warning("请输入正确的标签")},insertTag:function(e){this.selectedTagArr.length>19?this.$message.warning("最多添加20个标签"):(e.selected=!0,this.selectedTagArr.push({label:e.label,value:e.value}))},getAllTags:function(){var e=this;this.tagArr=[],this.$axios.post(m.B,{type:2}).then(function(t){t.data.data.forEach(function(t,a){e.tagArr.push({label:t.name,value:t.id})}),e.tagArr.forEach(function(t,a){e.selectedTagArr.forEach(function(e,a){t.value==e.value&&(e.label=t.label,t.selected=!0)})})}).catch(function(e){console.log(e)})},getLevelList:function(){var e=this;e.$axios.post(m.m,{}).then(function(t){e.users=t.data.data}).catch(function(e){console.log(e)})},handleCheckAllChange:function(e){var t=this;this.checkedUsers=[],this.isIndeterminate=!1,e?(this.users.forEach(function(e,a){t.checkedUsers.push(e.id)}),this.form.pushWay=this.checkedUsers.join(",")):(this.checkedUsers=[],this.form.pushWay="")},handleCheckedUsersChange:function(e){var t=e.length;this.form.pushWay=e.join(","),this.checkAll=t===this.users.length,this.isIndeterminate=t>0&&t<this.users.length},getFirstItem:function(){var e=this;this.itemList=[],this.$axios.post(m.l,{fatherid:0,pageSize:1e6}).then(function(t){t.data.data.data.forEach(function(t,a){e.itemList.push({label:t.name,value:t.id,children:[]}),e.handleItemChange([t.id])})}).catch(function(e){console.log(e)})},handleItemChange:function(e){var t=this,a=0;this.itemList.forEach(function(t,i){t.value==e[0]&&(a=i)});var i={};i.fatherid=e[0],i.pageSize=1e6,this.itemList[a].children=[],this.$axios.post(m.l,i).then(function(e){e.data.data.data.forEach(function(e,i){t.itemList[a].children.push({label:e.name,value:e.id})})}).catch(function(e){console.log(e)})},getProItemId:function(e,t){var a=this;this.form.brandId="";var i=this.form.secCategoryId=e[1];this.form.firstCategoryId=e[0],this.form.secCategoryId=e[1],this.brandArr=[],t||this.getProductParam(e[1]),this.$axios.post(m.s,{cId:i,pageSize:1e6}).then(function(e){e.data.data.forEach(function(e,t){a.brandArr.push({label:e.name,value:e.id})})}).catch(function(e){console.log(e)})},getSupplyList:function(){var e=this;this.form.supplier="";var t={};this.supplierList=[],t.firstCategoryId=this.form.firstCategoryId,t.secCategoryId=this.form.secCategoryId,t.brandId=this.form.brandId,t.pageSize=1e6,this.$axios.post(m.A,t).then(function(t){t.data.data.forEach(function(t,a){e.supplierList.push({label:t.name,value:t.supplier_id})})}).catch(function(e){console.log(e)})},getFreightTemplate:function(){var e=this;this.freightTemplateArr=[],this.$axios.post(m.n,{}).then(function(t){t.data.data.forEach(function(t,a){e.freightTemplateArr.push({label:t.name,value:t.id})})}).catch(function(e){console.log(e)})},goBack:function(){this.$router.push("giftManage")},getProductParam:function(e){var t=this;this.$axios.post(m.q,{categoryId:e}).then(function(e){t.productParam=[],e.data.data.forEach(function(e,a){e.parm_value="",t.productParam.push(e)})})}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"edit-gift"},[a("v-breadcrumb",{attrs:{nav:e.nav}}),e._v(" "),a("el-card",{attrs:{"body-style":{padding:"20px 45px",color:"#666"}}},[a("div",{staticClass:"pro-title"},[e._v("基本信息")]),e._v(" "),a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"礼包名称"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{maxlength:16,placeholder:"请输入产品名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"产品图片"}},[a("draggable",{staticStyle:{display:"inline-block"},attrs:{move:e.getdata},on:{update:e.datadragEnd},model:{value:e.imgArr,callback:function(t){e.imgArr=t},expression:"imgArr"}},[a("transition-group",e._l(e.imgArr,function(t,i){return a("div",{key:i,staticClass:"img-wrap"},[a("div",{staticClass:"delImg",on:{click:function(a){e.deleteImg(t)}}},[a("icon",{attrs:{ico:"icon-shanchu"}})],1),e._v(" "),a("img",{staticClass:"uImg",attrs:{src:t}})])}))],1),e._v(" "),a("el-upload",{staticClass:"img-uploader",attrs:{action:e.uploadImg,"show-file-list":!1,"on-success":e.successUpload,disabled:e.isUseUpload,multiple:""}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),a("div",{staticClass:"upload-tip"},[e._v("建议尺寸：800*800,拖拽图片可以改变顺序，第一张为默认头图")])],1),e._v(" "),a("el-form-item",{attrs:{label:"产品分类"}},[a("el-cascader",{attrs:{filterable:"",options:e.itemList,props:e.itemProps},on:{change:e.getProItemId,"active-item-change":e.handleItemChange},model:{value:e.proItemArr,callback:function(t){e.proItemArr=t},expression:"proItemArr"}}),e._v(" "),a("span",{staticStyle:{"margin-left":"30px"}},[e._v("产品品牌")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.getSupplyList},model:{value:e.form.brandId,callback:function(t){e.$set(e.form,"brandId",t)},expression:"form.brandId"}},e._l(e.brandArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"供应商"}},[a("el-select",{attrs:{placeholder:"下拉搜索供应商"},model:{value:e.form.supplier,callback:function(t){e.$set(e.form,"supplier",t)},expression:"form.supplier"}},e._l(e.supplierList,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"发货方"}},[a("el-select",{attrs:{placeholder:"选择发货方"},model:{value:e.form.originAddress,callback:function(t){e.$set(e.form,"originAddress",t)},expression:"form.originAddress"}},e._l(e.shipperArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"产品重量"}},[a("el-input",{staticClass:"pro-weight",model:{value:e.form.weight,callback:function(t){e.$set(e.form,"weight",t)},expression:"form.weight"}}),e._v("kg\n            ")],1),e._v(" "),a("el-form-item",{attrs:{label:"产品参数"}},[a("div",{staticClass:"product-param"},[0==e.productParm.length?a("span",[e._v("暂无数据")]):e._l(e.productParm,function(t,i){return a("span",{key:i},[e._v(e._s(t.param)+"："),a("el-input",{staticClass:"inp-param",model:{value:t.paramValue,callback:function(a){e.$set(t,"paramValue",a)},expression:"v.paramValue"}})],1)})],2)]),e._v(" "),a("div",{staticClass:"pro-title"},[e._v("运费其他")]),e._v(" "),a("el-form-item",{attrs:{label:"选择运费模板"}},[a("el-select",{attrs:{placeholder:"请选择模板"},model:{value:e.form.freightTpl,callback:function(t){e.$set(e.form,"freightTpl",t)},expression:"form.freightTpl"}},e._l(e.freightTemplateArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"交易默认时间"}},[a("transition",{attrs:{name:"fade"}},[e.showSaleTime?e._e():a("el-select",{model:{value:e.form.saleTime,callback:function(t){e.$set(e.form,"saleTime",t)},expression:"form.saleTime"}},e._l(e.times,function(t,i){return a("el-option",{key:i,attrs:{label:t.label,value:t.id}},[e._v("\n                            "+e._s(t.label)+"\n                        ")])})),e._v(" "),e.showSaleTime?a("el-input",{staticStyle:{width:"215px"},model:{value:e.form.saleTime,callback:function(t){e.$set(e.form,"saleTime",t)},expression:"form.saleTime"}}):e._e()],1),e._v(" "),a("el-button",{on:{click:e.defSaleTime}},[e._v("自定义")])],1),e._v(" "),a("div",{staticClass:"pro-title"},[e._v("产品详情")]),e._v(" "),a("el-form-item",[a("quill-editor",{ref:"myQuillEditor",attrs:{options:e.editorOption},on:{change:function(t){e.onEditorChange(t)}},model:{value:e.form.editorContent,callback:function(t){e.$set(e.form,"editorContent",t)},expression:"form.editorContent"}}),e._v(" "),a("el-upload",{ref:"upload",staticStyle:{display:"none"},attrs:{action:e.qnLocation,data:e.uploadData,"on-success":e.upScuccess}},[a("el-button",{attrs:{size:"small",type:"primary",id:"imgInput","element-loading-text":"插入中,请稍候"}},[e._v("点击上传\n                    ")])],1)],1),e._v(" "),a("div",{staticClass:"pro-title"},[e._v("礼包可购买角色设置")]),e._v(" "),a("el-form-item",{staticClass:"role-choose",attrs:{label:"请选择角色层级"}},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("\n                    全部用户\n                ")]),e._v(" "),a("div",{staticStyle:{margin:"15px 0"}}),e._v(" "),a("el-checkbox-group",{on:{change:e.handleCheckedUsersChange},model:{value:e.checkedUsers,callback:function(t){e.checkedUsers=t},expression:"checkedUsers"}},e._l(e.users,function(t,i){return a("el-checkbox",{key:i,attrs:{label:t.id}},[e._v(e._s(t.name)+"\n                    ")])})),e._v(" "),a("div",{staticClass:"tips"},[e._v("选择层级之后，根据用户的等级，购买受到限制")])],1),e._v(" "),a("div",{staticClass:"selected-tag"},[0==e.selectedTagArr.length?a("span",{staticClass:"tag-tip"},[e._v("请选择标签")]):e._e(),e._v(" "),e._l(e.selectedTagArr,function(t,i){return a("el-tag",{key:i,staticClass:"tag",attrs:{type:"info",closable:""},on:{close:function(a){e.handleClose(i,t)}}},[e._v(e._s(t.label))])})],2),e._v(" "),a("div",{staticClass:"add-tag"},[a("el-input",{staticStyle:{width:"215px","margin-right":"20px"},attrs:{placeholder:"请输入标签/至多可添加20个"},model:{value:e.tagName,callback:function(t){e.tagName=t},expression:"tagName"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addTag}},[e._v("添加标签")])],1),e._v(" "),a("div",{staticClass:"tag-list"},[0==e.tagArr.length?a("span",{staticClass:"tag-tip"},[e._v("请添加标签")]):e._e(),e._v(" "),e._l(e.tagArr,function(t,i){return a("el-button",{key:i,class:{"selected-btn":t.selected},staticStyle:{"margin-bottom":"10px"},attrs:{disabled:t.selected},on:{click:function(a){e.insertTag(t)}}},[e._v(e._s(t.label))])})],2),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确认发布")]),e._v(" "),a("el-button",{on:{click:e.goBack}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var v=a("VU/8")(f,p,!1,function(e){a("syA4")},null,null);t.default=v.exports},syA4:function(e,t){}});