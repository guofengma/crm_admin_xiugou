webpackJsonp([92],{AKT3:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("FMx0"),l=a("P9l9"),r=a("GVVA"),i={components:{breadcrumb:s.a},data:function(){return{nav:["权限管理","创建账号"],btnLoading:!1,checkAllUser:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],checkedUser:[[],[],[],[],[],[],[],[],[],[],[]],uploadImg:"",userManList:[],department:[],jobList:[],form:{name:"",telephone:"",deptmentId:[],jobId:"",immediateSuperior:"",face:""},rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],telephone:[{required:!0,message:"请输入手机号",trigger:"blur"}],deptmentId:[{required:!0,message:"请输入所属部门",trigger:"blur"}],jobId:[{required:!0,message:"请输入所在岗位",trigger:"blur"}],immediateSuperior:[{required:!0,message:"请输入直接上级ID",trigger:"blur"}]}}},activated:function(){this.form={},this.checkedUser=[[],[],[],[],[],[],[],[],[],[],[]],this.checkAllUser=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],this.uploadImg=l.uploadImg,this.getRoleList(),this.getDepartmentList()},methods:{submitForm:function(e){var t=this,a={},s=[];/^1(3|4|5|6|7|8)\d{9}$/.test(Number(this.form.telephone))?(this.checkedUser.forEach(function(e,t){e.forEach(function(e){s.push(e)})}),(a=this.form).role=s.join(","),this.btnLoading=!0,this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;r.a.addManger(a).then(function(e){t.btnLoading=!1,t.$message.success(e.msg),t.$router.push("/manageList")}).catch(function(e){console.log(e),t.btnLoading=!1})})):this.$message.warning("请输入正确的手机号！")},resetForm:function(e){this.$refs[e].resetFields()},uploadAvatar:function(e){this.form.face=e.data.imageUrl},handleCheckAllChangeUser:function(e,t){var a=[];this.userManList[t].value.forEach(function(e){e.value.forEach(function(e){a.push(e.id)})}),this.checkedUser[t]=e?a:[]},handleCheckedUserChange:function(e,t){var a=[],s=e.length;this.userManList[t].value.forEach(function(e){e.value.forEach(function(e){a.push(e.value)})}),this.checkAllUser[t]=s==a.length,this.$set(this.checkAllUser,t,this.checkAllUser[t])},getRoleList:function(){var e=this;r.a.getRoleList({}).then(function(t){e.userManList=t.data}).catch(function(e){console.log(e)})},getDepartmentList:function(){var e=this;this.department=[],r.a.queryDepartmentList({}).then(function(t){0!==t.data.length&&t.data.forEach(function(t,a){e.department.push({label:t.name,value:t.id})})}).catch(function(e){console.log(e)})},getJobList:function(e){var t=this;this.jobList=[],this.form.jobId="",r.a.queryJobList({id:e}).then(function(e){0!==e.data.length&&e.data.forEach(function(e,a){t.jobList.push({label:e.name,value:e.id})})}).catch(function(e){console.log(e)})}}},o={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"add-manger"},[s("breadcrumb",{attrs:{nav:e.nav}}),e._v(" "),s("el-card",[s("div",{staticClass:"add-box"},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[s("span",{staticClass:"add-box-title"},[e._v("基础信息")]),e._v(" "),s("el-form-item",{attrs:{prop:"name",label:"姓名"}},[s("el-input",{staticClass:"add-mange-inp",model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),s("el-form-item",{attrs:{prop:"telephone",label:"手机号"}},[s("el-input",{staticClass:"add-mange-inp",model:{value:e.form.telephone,callback:function(t){e.$set(e.form,"telephone",t)},expression:"form.telephone"}})],1),e._v(" "),s("div",{staticClass:"avatar"},[e.form.face?s("img",{attrs:{src:e.form.face}}):s("img",{attrs:{src:a("odpv"),alt:""}}),e._v(" "),s("el-upload",{attrs:{action:e.uploadImg,"show-file-list":!1,"on-success":e.uploadAvatar}},[s("el-button",{attrs:{type:"primary"}},[e._v("编辑头像")])],1),e._v(" "),s("div",{staticClass:"tip"},[e._v("请上传jpg，png格式")])],1),e._v(" "),s("div",{staticClass:"clearfix"}),e._v(" "),s("hr",{staticClass:"add-box-sep",attrs:{width:"90%",size:"1",color:"#ccc"}}),e._v(" "),s("span",{staticClass:"add-box-title"},[e._v("部门信息")]),e._v(" "),s("el-form-item",{attrs:{prop:"deptmentId",label:"所属部门"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:e.getJobList},model:{value:e.form.deptmentId,callback:function(t){e.$set(e.form,"deptmentId",t)},expression:"form.deptmentId"}},e._l(e.department,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),s("el-form-item",{attrs:{prop:"jobId",label:"所在岗位"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.jobId,callback:function(t){e.$set(e.form,"jobId",t)},expression:"form.jobId"}},e._l(e.jobList,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),s("el-form-item",{attrs:{prop:"immediateSuperior",label:"直接上级"}},[s("el-input",{staticClass:"add-mange-inp",model:{value:e.form.immediateSuperior,callback:function(t){e.$set(e.form,"immediateSuperior",t)},expression:"form.immediateSuperior"}})],1),e._v(" "),s("hr",{staticClass:"add-box-sep",attrs:{width:"90%",size:"1",color:"#ccc"}}),e._v(" "),s("span",{staticClass:"add-box-title"},[e._v("权限信息")]),e._v(" "),e._l(e.userManList,function(t,a){return s("el-collapse",{key:a,attrs:{accordion:""}},[s("el-collapse-item",[s("template",{slot:"title"},[s("el-checkbox",{staticClass:"collapse-tit",on:{change:function(t){e.handleCheckAllChangeUser(e.checkAllUser[a],a)}},model:{value:e.checkAllUser[a],callback:function(t){e.$set(e.checkAllUser,a,t)},expression:"checkAllUser[k]"}},[e._v(e._s(t.title))])],1),e._v(" "),s("el-checkbox-group",{on:{change:function(t){e.handleCheckedUserChange(e.checkedUser[a],a)}},model:{value:e.checkedUser[a],callback:function(t){e.$set(e.checkedUser,a,t)},expression:"checkedUser[k]"}},e._l(t.value,function(t,a){return s("div",{key:a},[s("div",{staticClass:"collapse-title"},[e._v(e._s(t.title))]),e._v(" "),s("div",{staticStyle:{overflow:"hidden","margin-bottom":"10px"}},[s("div",{staticClass:"collapse-item"},e._l(t.value,function(t,a){return s("el-checkbox",{key:a,attrs:{label:t.id}},[e._v(e._s(t.title))])}))])])}))],2)],1)}),e._v(" "),s("el-form-item",[s("el-button",{staticStyle:{"margin-left":"35%"},attrs:{type:"primary",loading:e.btnLoading},on:{click:function(t){e.submitForm("form")}}},[e._v("提交")]),e._v(" "),s("el-button",{on:{click:function(t){e.resetForm("form")}}},[e._v("重置")])],1)],2)],1)])],1)},staticRenderFns:[]};var n=a("VU/8")(i,o,!1,function(e){a("p4D7")},null,null);t.default=n.exports},p4D7:function(e,t){}});