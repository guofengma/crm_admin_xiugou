webpackJsonp([106],{CvKi:function(e,a){},mvKA:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=t("mvHQ"),r=t.n(i),l=t("FMx0"),s=t("DAYN"),o=t.n(s),n=t("yPE/"),c=t.n(n),d=t("UU1J"),u=t("5fic"),m=t("V3Ru"),g=t("0xDb"),f=t.n(g),h={components:{draggable:o.a,vBreadcrumb:l.a,icon:d.a},data:function(){return{nav:["运营管理","营销工具管理","优惠套餐","编辑套餐"],isUseUpload:!1,uploadImg:"",imgArr:[],showSaleTime:!1,showDealTime:!1,categoryArr:[],itemList:[],brandArr:[],itemProps:{value:"value",children:"children"},proItemArr:[],freightTemplateArr:[],supplierArr:[],shipperArr:[{label:"平台发货",value:"1"},{label:"供应商发货",value:"2"}],aferServiceDays:[{label:"无售后服务",value:"0"},{label:"到货后7天",value:"7"},{label:"到货后15天",value:"15"},{label:"到货后30天",value:"30"},{label:"到货后6个月",value:"180"},{label:"到货后1年",value:"365"},{label:"到货后2年",value:"730"},{label:"到货后3年",value:"1095"}],times:[{label:"7天",id:"7"},{label:"10天",id:"10"},{label:"15天",id:"15"},{label:"20天",id:"20"},{label:"25天",id:"25"},{label:"30天",id:"30"}],specArr:[],form:{name:"",firstCategoryId:"",secCategoryId:"",brandId:"",supplierId:"",sendfrom:"",weight:"",freightTemplateId:"",aferServiceDays:"",dealDays:"",content:"",tagStr:"",originalImgStr:"",smallImgStr:""},editorOption:{placeholder:"请输入内容",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image"]]}},uploadData:{},uploadType:"",selectedTagArr:[],tagArr:[],tagName:"",btnLoading:!1,packageId:"",packageCode:""}},computed:{qnLocation:function(){return location.protocol,u.a}},activated:function(){this.uploadImg=u.a,this.imgArr=[],this.selectedTagArr=[],this.getFirstItem(),this.getFreightTemplate(),f.a.cleanFormData(this.form),this.packageId=this.$route.query.packageId,this.packageCode=this.$route.query.packageCode,this.getProductInfo()},mounted:function(){this.$refs.myQuillEditor.quill.getModule("toolbar").addHandler("image",this.imgHandler)},methods:{getProductInfo:function(){var e=this,a={};a.id=this.packageId,a.url=m.findOperActivityPackageById,this.$axios.post(u.h,a).then(function(a){e.imgArr=[],e.form.name=a.data.data.name,e.form.weight=a.data.data.weight,e.form.content=a.data.data.content,a.data.data.imgList.forEach(function(a,t){e.imgArr.push({originUrl:a.original_img,smallUrl:a.small_img})}),e.categoryArr=[],e.categoryArr.push(a.data.data.firstCategoryId),e.categoryArr.push(a.data.data.secCategoryId),e.getProItemId(e.categoryArr,a.data.data.paramList),e.form.brandId=a.data.data.brandId,e.getSupplyList(a.data.data.firstCategoryId,a.data.data.secCategoryId,a.data.data.brandId),e.form.supplierId=a.data.data.supplierId,e.form.sendfrom=a.data.data.sendfrom.toString(),e.form.freightTemplateId=a.data.data.freightTemplateId,e.form.aferServiceDays=a.data.data.aferServiceDays.toString(),e.form.dealDays=a.data.data.dealDays.toString(),e.selectedTagArr=[],a.data.data.tagList.forEach(function(a,t){e.selectedTagArr.push({label:a.name,value:a.id})}),e.getAllTags()}).catch(function(e){console.log(e)})},beforeSubmit:function(){return/^[\da-zA-Z_\u4e00-\u9f5a]{4,16}$/.test(this.form.name)?0==this.imgArr.length?(this.$message.warning("请添加产品图片"),!1):0==this.selectedTagArr.length?(this.$message.warning("请添加产品标签"),!1):parseInt(this.form.weight)>=0||(this.$message.warning("请输入正确的重量"),!1):(this.$message.warning("套餐名称不符合规则!"),!1)},submitForm:function(){var e=this;if(this.beforeSubmit()){var a=[],t=[],i=[];this.selectedTagArr.forEach(function(e,t){a.push(e.value)}),this.form.tagStr=a.join(","),this.imgArr.forEach(function(e,a){t.push(e.smallUrl),i.push(e.originUrl)});var l=[];this.specArr.forEach(function(e,a){e.parmValue&&l.push({parmId:e.id,parmValue:e.parmValue})}),this.form.specStr=r()(l),this.form.smallImgStr=t.join(","),this.form.originalImgStr=i.join(",");var s={};(s=this.form).id=this.packageId,s.packageCode=this.packageCode,s.url=m.updateOperActivityPackage,this.btnLoading=!0,this.$axios.post(u.E,s).then(function(a){e.$message.success(a.data.msg),e.$router.push("/packageList"),e.btnLoading=!1}).catch(function(a){console.log(a),e.btnLoading=!1})}},beforeUploadArr:function(){this.$message.warning("上传中...")},getdata:function(e){},datadragEnd:function(e){},successUpload:function(e){if(200==e.code){if(this.imgArr.length>=5)return this.isUseUpload=!0,void this.$message.warning("最多只能上传五张图片");this.imgArr.push({originUrl:e.data.imageUrl,smallUrl:e.data.imageThumbUrl}),this.$message.success("上传成功")}else this.$message.warning(e.data.msg)},deleteImg:function(e){var a=-1;this.imgArr.forEach(function(t,i){t.originUrl==e.originUrl&&(a=i)}),-1!=a&&(this.imgArr.splice(a,1),this.imgArr.length<5&&(this.isUseUpload=!1))},defSaleTime:function(){this.form.aferServiceDays="",this.showSaleTime=!this.showSaleTime},defDealTime:function(){this.form.dealDays="",this.showDealTime=!this.showDealTime},onEditorChange:function(e){e.editor;var a=e.html;e.text;this.form.content=a},upScuccess:function(e,a,t){this.fullscreenLoading=!1;var i=this,r="";if("image"===this.uploadType&&(r=e.data.imageUrl,this.form.original_img=e.data.imageUrl,this.form.small_img=e.data.imageThumbUrl,console.log(e)),null!=r&&r.length>0){var l=r;i.addRange=i.$refs.myQuillEditor.quill.getSelection(),l=-1!==l.indexOf("http")?l:"http:"+l,i.$refs.myQuillEditor.quill.insertEmbed(null!==i.addRange?i.addRange.index:0,i.uploadType,l,c.a.sources.USER),this.$message.success("插入成功")}else this.$message.error(i.uploadType+"插入失败");this.$refs.upload.clearFiles()},imgHandler:function(e){(this.addRange=this.$refs.myQuillEditor.quill.getSelection(),e)&&document.getElementById("imgInput").click();this.uploadType="image"},handleClose:function(e,a){var t=this;this.selectedTagArr.splice(e,1),this.tagArr.forEach(function(e,i){a.label==e.label&&(t.tagArr[i].selected=!1)})},addTag:function(){var e=this;if(""!=this.tagName){var a=!1;if(this.tagArr.forEach(function(t,i){e.tagName==t.label&&(a=!0)}),a)this.$message.warning("标签已经添加，请不要重复添加!");else{var t={};t.name=this.tagName,t.type=2,this.$axios.post(u.e,t).then(function(a){e.$message.success("添加成功!"),e.tagName="",e.getAllTags()}).catch(function(e){console.log(e)})}}else this.$message.warning("请输入正确的标签")},insertTag:function(e){this.selectedTagArr.length>19?this.$message.warning("最多添加20个标签"):(e.selected=!0,this.selectedTagArr.push({label:e.label,value:e.value}))},getFirstItem:function(){var e=this;this.itemList=[],this.$axios.post(u.j,{fatherid:0,type:2,pageSize:1e4}).then(function(a){a.data.data.data.forEach(function(a,t){e.itemList.push({label:a.name,value:a.id,children:[]}),e.handleItemChange(a.id)})}).catch(function(e){console.log(e)})},handleItemChange:function(e){var a=this,t=0;this.itemList.forEach(function(a,i){a.value==e&&(t=i)});var i={};i.fatherid=e,i.type=2,i.pageSize=1e4,this.itemList[t].children=[],this.$axios.post(u.j,i).then(function(e){e.data.data.data.forEach(function(e,i){a.itemList[t].children.push({label:e.name,value:e.id})})}).catch(function(e){console.log(e)})},getProItemId:function(e,a){var t=this,i=this.form.secCategoryId=e[1];this.form.firstCategoryId=e[0],this.form.secCategoryId=e[1],this.brandArr=[],this.specArr=[],this.$axios.post(u.s,{cId:i,pageSize:1e4}).then(function(e){e.data.data.forEach(function(e,a){t.brandArr.push({label:e.name,value:e.id})})}).catch(function(e){console.log(e)}),this.$axios.post(u.m,{categoryId:i}).then(function(e){t.specArr=e.data.data;var i=t;a.forEach(function(e,a){var t=e.parmId;i.specArr.forEach(function(a,i){a.id==t&&(a.parmValue=e.parmValue)})})}).catch(function(e){console.log(e)})},getSupplyList:function(e,a,t){var i=this,r={};this.supplierArr=[],r.firstCategoryId=e,r.secCategoryId=a,r.brandId=t,this.$axios.post(u.B,r).then(function(e){e.data.data.forEach(function(e,a){i.supplierArr.push({label:e.name,value:e.supplier_id})})}).catch(function(e){console.log(e)})},getFreightTemplate:function(){var e=this;this.freightTemplateArr=[],this.$axios.post(u.l,{}).then(function(a){a.data.data.forEach(function(a,t){e.freightTemplateArr.push({label:a.name,value:a.id})})}).catch(function(e){console.log(e)})},getAllTags:function(){var e=this;this.tagArr=[],this.$axios.post(u.C,{type:2}).then(function(a){a.data.data.forEach(function(a,t){e.tagArr.push({label:a.name,value:a.id})}),e.tagArr.forEach(function(a,t){e.selectedTagArr.forEach(function(e,t){a.value==e.value&&(a.selected=!0)})})}).catch(function(e){console.log(e)})},backToList:function(){this.$router.push("/packageList")}}},p={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"add-package"},[t("v-breadcrumb",{attrs:{nav:e.nav}}),e._v(" "),t("el-card",{attrs:{"body-style":{padding:"20px 45px",color:"#666"}}},[t("div",{staticClass:"pro-title"},[e._v("基本信息")]),e._v(" "),t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"套餐名称"}},[t("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入套餐名称"},model:{value:e.form.name,callback:function(a){e.$set(e.form,"name",a)},expression:"form.name"}}),e._v(" "),t("span",{staticClass:"upload-tip"},[e._v("规则:4~16位汉字、字母、下划线的组合")])],1),e._v(" "),t("el-form-item",{attrs:{label:"产品图片"}},[t("draggable",{staticStyle:{display:"inline-block"},attrs:{move:e.getdata},on:{update:e.datadragEnd},model:{value:e.imgArr,callback:function(a){e.imgArr=a},expression:"imgArr"}},[t("transition-group",e._l(e.imgArr,function(a,i){return t("div",{key:i,staticClass:"img-wrap"},[t("div",{staticClass:"delImg",on:{click:function(t){e.deleteImg(a)}}},[t("icon",{attrs:{ico:"icon-shanchu"}})],1),e._v(" "),t("img",{staticClass:"uImg",attrs:{src:a.originUrl}})])}))],1),e._v(" "),t("el-upload",{staticClass:"img-uploader",attrs:{"before-upload":e.beforeUploadArr,action:e.uploadImg,"show-file-list":!1,"on-success":e.successUpload,disabled:e.isUseUpload,multiple:""}},[t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),t("div",{staticClass:"upload-tip"},[e._v("建议尺寸：800*800,拖拽图片可以改变顺序，第一张为默认头图")])],1),e._v(" "),t("el-form-item",{attrs:{label:"产品分类"}},[t("el-cascader",{attrs:{filterable:"",options:e.itemList,props:e.itemProps},on:{change:e.getProItemId,"active-item-change":e.handleItemChange},model:{value:e.categoryArr,callback:function(a){e.categoryArr=a},expression:"categoryArr"}}),e._v(" "),t("span",{staticStyle:{"margin-left":"30px"}},[e._v("产品品牌")]),e._v(" "),t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.getSupplyList},model:{value:e.form.brandId,callback:function(a){e.$set(e.form,"brandId",a)},expression:"form.brandId"}},e._l(e.brandArr,function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"供应商"}},[t("el-select",{attrs:{placeholder:"下拉搜索供应商"},model:{value:e.form.supplierId,callback:function(a){e.$set(e.form,"supplierId",a)},expression:"form.supplierId"}},e._l(e.supplierArr,function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"发货方"}},[t("el-select",{attrs:{placeholder:"选择发货方"},model:{value:e.form.sendfrom,callback:function(a){e.$set(e.form,"sendfrom",a)},expression:"form.sendfrom"}},e._l(e.shipperArr,function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"产品重量"}},[t("el-input",{staticClass:"pro-weight",model:{value:e.form.weight,callback:function(a){e.$set(e.form,"weight",a)},expression:"form.weight"}}),e._v("\n                kg\n            ")],1),e._v(" "),t("el-form-item",{attrs:{label:"产品参数"}},[t("div",{staticClass:"product-param"},[e._l(e.specArr,function(a,i){return[t("span",[e._v(e._s(a.parm))]),e._v(" "),t("el-input",{staticClass:"inp-param",model:{value:a.parmValue,callback:function(t){e.$set(a,"parmValue",t)},expression:"v.parmValue"}})]})],2)]),e._v(" "),t("div",{staticClass:"pro-title"},[e._v("运费信息")]),e._v(" "),t("el-form-item",{attrs:{label:"选择运费模板"}},[t("el-select",{attrs:{placeholder:"请选择模板"},model:{value:e.form.freightTemplateId,callback:function(a){e.$set(e.form,"freightTemplateId",a)},expression:"form.freightTemplateId"}},e._l(e.freightTemplateArr,function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"售后周期"}},[t("transition",{attrs:{name:"fade"}},[e.showSaleTime?e._e():t("el-select",{attrs:{placeholder:"请选择售后周期"},model:{value:e.form.aferServiceDays,callback:function(a){e.$set(e.form,"aferServiceDays",a)},expression:"form.aferServiceDays"}},e._l(e.aferServiceDays,function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),e._v(" "),e.showSaleTime?t("el-input",{staticStyle:{width:"215px"},attrs:{placeholder:"请输入售后周期"},model:{value:e.form.aferServiceDays,callback:function(a){e.$set(e.form,"aferServiceDays",a)},expression:"form.aferServiceDays"}}):e._e()],1),e._v(" "),t("el-button",{on:{click:e.defSaleTime}},[e._v("自定义")])],1),e._v(" "),t("el-form-item",{attrs:{label:"交易默认时间"}},[t("transition",{attrs:{name:"fade"}},[e.showDealTime?e._e():t("el-select",{attrs:{placeholder:"请选择交易默认时间"},model:{value:e.form.dealDays,callback:function(a){e.$set(e.form,"dealDays",a)},expression:"form.dealDays"}},e._l(e.times,function(a,i){return t("el-option",{key:i,attrs:{label:a.label,value:a.id}},[e._v("\n                            "+e._s(a.label)+"\n                        ")])})),e._v(" "),e.showDealTime?t("el-input",{staticStyle:{width:"215px"},attrs:{placeholder:"请输入交易默认时间"},model:{value:e.form.defaultTime,callback:function(a){e.$set(e.form,"defaultTime",a)},expression:"form.defaultTime"}}):e._e()],1),e._v(" "),t("el-button",{on:{click:e.defDealTime}},[e._v("自定义")])],1),e._v(" "),t("div",{staticClass:"pro-title"},[e._v("产品详情")]),e._v(" "),t("quill-editor",{ref:"myQuillEditor",attrs:{options:e.editorOption},on:{change:function(a){e.onEditorChange(a)}},model:{value:e.form.content,callback:function(a){e.$set(e.form,"content",a)},expression:"form.content"}}),e._v(" "),t("el-upload",{ref:"upload",staticStyle:{display:"none"},attrs:{action:e.qnLocation,data:e.uploadData,"on-success":e.upScuccess}},[t("el-button",{attrs:{size:"small",type:"primary",id:"imgInput","element-loading-text":"插入中,请稍候"}},[e._v("点击上传")])],1),e._v(" "),t("div",{staticClass:"selected-tag"},[0==e.selectedTagArr.length?t("span",{staticClass:"tag-tip"},[e._v("请选择标签")]):e._e(),e._v(" "),e._l(e.selectedTagArr,function(a,i){return t("el-tag",{key:i,staticClass:"tag",attrs:{type:"info",closable:""},on:{close:function(t){e.handleClose(i,a)}}},[e._v(e._s(a.label)+"\n                ")])})],2),e._v(" "),t("div",{staticClass:"add-tag"},[t("el-input",{staticStyle:{width:"215px","margin-right":"20px"},attrs:{placeholder:"请输入标签/至多可添加20个"},model:{value:e.tagName,callback:function(a){e.tagName=a},expression:"tagName"}}),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.addTag}},[e._v("添加标签")])],1),e._v(" "),t("div",{staticClass:"tag-list"},[0==e.tagArr.length?t("span",{staticClass:"tag-tip"},[e._v("请添加标签")]):e._e(),e._v(" "),e._l(e.tagArr,function(a,i){return t("el-button",{key:i,class:{"selected-btn":a.selected},staticStyle:{"margin-bottom":"10px"},attrs:{disabled:a.selected},on:{click:function(t){e.insertTag(a)}}},[e._v(e._s(a.label)+"\n                ")])})],2),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:e.submitForm}},[e._v("确认发布")]),e._v(" "),t("el-button",{on:{click:e.backToList}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var v=t("VU/8")(h,p,!1,function(e){t("CvKi")},null,null);a.default=v.exports}});