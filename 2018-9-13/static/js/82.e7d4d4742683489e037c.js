webpackJsonp([82],{UyNn:function(t,e){},aBbE:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("FMx0"),r=a("P9l9"),l=a("19nM"),i=a("0xDb"),n=a.n(i),s=a("PJh5"),c=a.n(s),d={components:{breadcrumb:o.a},data:function(){return{p:{productionSecurityCode:!1,exportSecurityCode:!1,updateCodeStatus:!1},isShowOperate:!0,nav:["溯源管理","防伪码管理"],isShowDialog:!1,exportBtn:!1,level:[{label:"全部",value:""},{label:"待确认",value:"0"},{label:"未入库",value:"1"},{label:"已入库",value:"2"},{label:"已出库",value:"3"},{label:"正在生成",value:"8"},{label:"已经生成",value:"9"}],form:{status:"",beginTime:"",endTime:""},firstProduct:[],secondProduct:[],codetplList:[],productList:[],product:[{label:"袜子",value:1}],smallBoxCodeNum:0,packagingCodeNum:0,smallNum:0,packageNum:0,diaForm:{firstProductItem:"",secondProductItem:"",productBrand:"",product:"",tpl:"",productNum:"",note:""},diaRules:{productNum:[{required:!0,message:"请输入产品数量",trigger:"blur"}],firstProductItem:[{required:!0,message:"请输入类目",trigger:"blur"}],productBrand:[{required:!0,message:"请选择品牌",trigger:"blur"}],product:[{required:!0,message:"请选择产品",trigger:"blur"}],tpl:[{required:!0,message:"请选择模板",trigger:"blur"}]},tableLoading:!1,tableData:[],height:"",page:{currentPage:1,totalPage:20}}},created:function(){var t=window.screen.availHeight-500;this.height=t,this.pControl()},activated:function(){this.pControl(),this.getList(this.page.currentPage),this.getProductFirstName(),this.getCodeTplList()},methods:{pControl:function(){for(var t in this.p)this.p[t]=n.a.pc(l[t]);this.p.exportSecurityCode||this.p.updateCodeStatus||(this.isShowOperate=!1)},getList:function(t){var e=this,a=this,o={};this.tableData=[],o.beginTime=""==this.form.beginTime?"":c()(this.form.beginTime).format("YYYY-MM-DD HH:mm:ss"),o.endTime=""==this.form.endTime?"":c()(this.form.endTime).format("YYYY-MM-DD HH:mm:ss"),o.status=this.form.status,o.page=t,o.url=l.getRecordPage,this.tableLoading=!0,this.$axios.post(r.getRecordPage,o).then(function(t){200==t.data.code?(a.tableData=t.data.data.data,a.tableLoading=!1,a.page.totalPage=t.data.data.resultCount):(a.tableLoading=!1,e.$message.warning(t.data.msg))}).catch(function(t){console.log(t),a.tableLoading=!1})},handleSizeChange:function(t){console.log("每页 "+t+" 条")},handleCurrentChange:function(t){console.log("当前页: "+t),this.page.currentPage=t,this.getList(t)},createCode:function(){this.diaForm={},this.smallNum=0,this.packageNum=0,this.isShowDialog=!0},confirmCreateCode:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;var a={};a.brandId=e.diaForm.productBrand,a.categoryId=e.diaForm.product,a.productNum=e.diaForm.productNum,a.templateId=e.diaForm.tpl,a.remark=e.diaForm.note,a.url=l.productionSecurityCode,e.$axios.post(r.productionSecurityCode,a).then(function(t){200==t.data.code?(e.$message.success(t.data.data),e.isShowDialog=!1):e.$message.warning(t.data.msg)}).catch(function(t){console.log(t)})})},selectTpl:function(){this.isShowDialog=!1,this.$router.push("/rootsCodeTpl")},resetForm:function(t){this.$refs[t].resetFields()},importCode:function(t){var e={};e.productCode=t.productCode,e.recordId=t.id,e.url=l.exportSecurityCode,this.$axios.post(r.exportSecurityCode,e,{responseType:"blob"}).then(function(a){var o=window.URL.createObjectURL(new Blob([e])),r=document.createElement("a");r.style.display="none",r.href=o,r.setAttribute("download",t.brandName+".xlsx"),document.body.appendChild(r),r.click()}).catch(function(t){console.log(t)})},updateCodeStatus:function(t,e){var a=this,o={};o.id=t.id,o.productCode=t.productCode,o.status=e,o.url=l.updateCodeStatus,this.$axios.post(r.updateCodeStatus,o).then(function(o){200==o.data.code?(a.$message.success("修改成功！"),t.status=e):a.$message.warning(o.data.msg)}).catch(function(t){console.log(t)})},getProductFirstName:function(){var t=this,e=this;this.firstProduct=[],this.$axios.post(r.getFirstList,{}).then(function(a){200==a.data.code?a.data.data.forEach(function(t,a){e.firstProduct.push({label:t.name,value:t.id})}):t.$message.warning(a.data.msg)}).catch(function(t){console.log(t)})},getProductSecondName:function(t){var e=this,a=this,o={};this.secondProduct=[],o.fatherid=t,this.$axios.post(r.getSecondList,o).then(function(t){200==t.data.code?(t.data.data.forEach(function(t,e){a.secondProduct.push({label:t.name,value:t.id})}),a.diaForm.secondProductItem=void 0==a.secondProduct[0]?"":a.secondProduct[0].value):e.$message.warning(t.data.msg)}).catch(function(t){console.log(t)})},getProductBrand:function(t){var e=this,a=this,o={};this.productList=[],o.cId=t,this.$axios.post(r.queryCategoryBrandCid,o).then(function(t){200==t.data.code?t.data.data.forEach(function(t,e){a.productList.push({label:t.name,value:t.id})}):e.$message.warning(t.data.msg)}).catch(function(t){console.log(t)})},getCodeTplList:function(){var t=this,e=this;this.codetplList=[],this.$axios.post(r.getAllgetAllActivety,{}).then(function(a){200==a.data.code?a.data.data.forEach(function(t,a){e.codetplList.push({label:t.templateName,value:t.id})}):t.$message.warning(a.data.msg)}).catch(function(t){console.log(t)})},getCodeTplMsg:function(t){var e=this,a={};a.id=t,this.$axios.post(r.rootsQueryCodeTplList,a).then(function(t){200==t.data.code?(e.smallBoxCodeNum=t.data.data.smallBoxCodeNum,e.packagingCodeNum=t.data.data.packagingCodeNum,e.getCodeNum()):e.$message.warning(t.data.msg)}).catch(function(t){console.log(t)})},getCodeNum:function(){var t=this.diaForm.productNum;0!=/^[0-9]*[1-9][0-9]*$/.test(t=void 0==t?0:t)||0==t?(this.smallNum=this.smallBoxCodeNum*parseInt(t),this.packageNum=this.packagingCodeNum*parseInt(t),console.log(this.smallNum)):this.$message.warning("请输入正确的数字!")}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("breadcrumb",{attrs:{nav:t.nav}}),t._v(" "),a("el-card",[a("el-form",{ref:"form",attrs:{model:t.form,inline:"","label-width":"120px"}},[a("el-form-item",{attrs:{prop:"status",label:"防伪码状态"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.level,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{prop:"beginTime",label:"操作开始时间"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择开始时间","default-time":"00:00:00"},model:{value:t.form.beginTime,callback:function(e){t.$set(t.form,"beginTime",e)},expression:"form.beginTime"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"endTime",label:"操作结束时间"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择结束时间","default-time":"00:00:00"},model:{value:t.form.endTime,callback:function(e){t.$set(t.form,"endTime",e)},expression:"form.endTime"}})],1),t._v(" "),a("el-form-item",{attrs:{label:" "}},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.getList(1)}}},[t._v("搜索")]),t._v(" "),a("el-button",{on:{click:function(e){t.resetForm("form")}}},[t._v("重置")])],1)],1)],1),t._v(" "),a("el-card",{staticClass:"con-card"},[t.p.productionSecurityCode?a("el-button",{attrs:{type:"primary"},on:{click:t.createCode}},[t._v("生成防伪码")]):t._e(),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticClass:"w-table",staticStyle:{width:"100%"},attrs:{stripe:"",data:t.tableData,height:t.height,border:""}},[a("el-table-column",{attrs:{prop:"id",label:"方位记录ID",width:"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"categoryId",label:"产品类型",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"brandName",label:"产品品牌",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"导出时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(t._f("formatDate")(e.row.createTime))+"\n            ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"productNum",label:"导出数量",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注说明",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.status?[t._v("待确认")]:1==e.row.status?[t._v("未入库")]:2==e.row.status?[t._v("已入库")]:3==e.row.status?[t._v("已出库")]:8==e.row.status?[t._v("正在生成 ")]:9==e.row.status?[t._v("已经生成")]:t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"inWareHouseNum",label:"已入库",width:"70",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"noWareHouseNum",label:"未入库",width:"70",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"outWareHouseNum",label:"已出库",width:"70",align:"center"}}),t._v(" "),t.isShowOperate?a("el-table-column",{attrs:{label:"操作",width:"250",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.p.exportSecurityCode?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){t.importCode(e.row)}}},[t._v("导出防伪码")]):t._e(),t._v(" "),0==e.row.status&&t.p.updateCodeStatus?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){t.updateCodeStatus(e.row,"1")}}},[t._v("待确认")]):t._e(),t._v(" "),1==e.row.status&&t.p.updateCodeStatus?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){t.updateCodeStatus(e.row,"2")}}},[t._v("确认入库")]):t._e()]}}])}):t._e()],1),t._v(" "),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{background:"","current-page":t.page.currentPage,layout:"total, prev, pager, next, jumper",total:t.page.totalPage},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"生成防伪码",visible:t.isShowDialog},on:{"update:visible":function(e){t.isShowDialog=e}}},[a("el-form",{ref:"diaForm",attrs:{model:t.diaForm,rules:t.diaRules,"label-width":"80px"}},[a("el-form-item",{attrs:{prop:"firstProductItem",label:"产品分类"}},[a("el-select",{attrs:{placeholder:"请选择分类"},on:{change:t.getProductSecondName},model:{value:t.diaForm.firstProductItem,callback:function(e){t.$set(t.diaForm,"firstProductItem",e)},expression:"diaForm.firstProductItem"}},t._l(t.firstProduct,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),t._v(" "),a("el-select",{attrs:{placeholder:"请选择分类"},on:{change:t.getProductBrand},model:{value:t.diaForm.secondProductItem,callback:function(e){t.$set(t.diaForm,"secondProductItem",e)},expression:"diaForm.secondProductItem"}},t._l(t.secondProduct,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{prop:"productBrand",label:"产品品牌"}},[a("el-select",{attrs:{placeholder:"请选择品牌"},model:{value:t.diaForm.productBrand,callback:function(e){t.$set(t.diaForm,"productBrand",e)},expression:"diaForm.productBrand"}},t._l(t.productList,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{prop:"product",label:"产品"}},[a("el-select",{attrs:{placeholder:"请选择产品"},model:{value:t.diaForm.product,callback:function(e){t.$set(t.diaForm,"product",e)},expression:"diaForm.product"}},t._l(t.product,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1),a("br"),t._v(" "),a("el-form-item",{attrs:{prop:"tpl",label:"选择模板"}},[a("el-select",{attrs:{placeholder:"请选择模板"},on:{change:t.getCodeTplMsg},model:{value:t.diaForm.tpl,callback:function(e){t.$set(t.diaForm,"tpl",e)},expression:"diaForm.tpl"}},t._l(t.codetplList,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),t._v(" "),a("span",{staticClass:"selectTpl",on:{click:t.selectTpl}},[t._v("去选择模板")])],1),t._v(" "),a("el-form-item",{attrs:{prop:"productNum",label:"产品数量"}},[a("el-input",{staticClass:"roots-inp",on:{input:t.getCodeNum},model:{value:t.diaForm.productNum,callback:function(e){t.$set(t.diaForm,"productNum",e)},expression:"diaForm.productNum"}}),t._v(" 套\n        ")],1),t._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.diaForm.note,callback:function(e){t.$set(t.diaForm,"note",e)},expression:"diaForm.note"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"生成:"}},[a("span",{staticStyle:{color:"#ff6868"}},[t._v("共生成"+t._s(t.smallNum)+"个箱码，"+t._s(t.packageNum)+"个包装码")])])],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.confirmCreateCode("diaForm")}}},[t._v("确 定")]),t._v(" "),a("el-button",{on:{click:function(e){t.isShowDialog=!1}}},[t._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(d,u,!1,function(t){a("UyNn")},null,null);e.default=m.exports}});