webpackJsonp([140],{GF4k:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o("mvHQ"),n=o.n(s),i=o("UU1J"),a=o("GVVA"),r={components:{icon:i.a},data:function(){return{loginType:"first",btnLoading:!1,code:!0,codeTime:5,form1:{phone:"",password:"a123456"},form2:{phone:"",code:""},rules:{phone:[{required:!0,message:"请输入登录手机号",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(o){if(!o)return console.log("error submit!!"),!1;var s=t[e],n=void 0;if(n="form1"===e?"loginByPwd":"loginByCode",11==t[e].phone.length){/^[0-9]*[1-9][0-9]*$/.test(t[e].phone)?(t.btnLoading=!0,a.a[n](s).then(function(e){console.log(e),localStorage.setItem("ms_username",e.data.name),localStorage.setItem("ms_userID",e.data.id),localStorage.setItem("ms_userPhone",e.data.telephone),localStorage.setItem("ms_hadFirstLogin",e.data.hadFirstLogin),t.getUserPriList(e.data.id),t.btnLoading=!1}).catch(function(e){t.btnLoading=!1,console.log(e)})):t.$message.warning("账号不能含有字符或者符号")}else t.$message.warning("账号长度不符")})},getCode:function(){var e=this;if(""!==this.form2.phone)if(11===this.form2.phone.length){if(/^[0-9]*[1-9][0-9]*$/.test(this.form2.phone)){var t=this;this.code=!1,this.codeTime=60;var o=setInterval(function(){t.codeTime--,t.codeTime<=0&&(t.code=!0,clearInterval(o))},1e3),s={phone:this.form2.phone,code:"ADMIN_LOGIN_CODE"};a.a.getCode(s).then(function(t){e.$message.success(t.data.data)})}else this.$message.warning("账号不能含有字符或者符号")}else this.$message.warning("账号长度不符");else this.$message.warning("请输入手机号!")},tabClick:function(e){},getUserPriList:function(e){var t=this;a.a.findAdminUserbyId({id:e}).then(function(e){var o=[];e.data.adminUserPrivilegeList.forEach(function(e,t){o.push(e.url)}),localStorage.setItem("privilegeList",n()(o)),t.$message.success("登录成功！"),t.$router.push("/dashboard"),t.btnLoading=!1}).catch(function(e){t.btnLoading=!1,console.log(e)})}}},l={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"login-wrap"},[o("div",{staticClass:"ms-title"},[e._v("CRM系统后台登录")]),e._v(" "),o("div",{staticClass:"ms-login"},[o("el-tabs",{staticClass:"tab",attrs:{type:"card"},on:{"tab-click":e.tabClick},model:{value:e.loginType,callback:function(t){e.loginType=t},expression:"loginType"}},[o("el-tab-pane",{attrs:{label:"账号登录",name:"first"}},[o("el-form",{ref:"form1",attrs:{model:e.form1,rules:e.rules,"label-width":"0px"}},[o("el-form-item",{attrs:{prop:"phone"}},[o("el-input",{staticClass:"login-inp",attrs:{size:"large",placeholder:"请输入登录手机号"},model:{value:e.form1.phone,callback:function(t){e.$set(e.form1,"phone",t)},expression:"form1.phone"}},[o("icon",{staticClass:"login-ico",attrs:{slot:"prefix",ico:"icon-zhucedengluyonghuming"},slot:"prefix"})],1)],1),e._v(" "),o("el-form-item",{staticStyle:{"margin-top":"-40px"},attrs:{prop:"password"}},[o("el-input",{staticClass:"login-inp",attrs:{type:"password",size:"large",placeholder:"请输入登录密码"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.submitForm("form1")}},model:{value:e.form1.password,callback:function(t){e.$set(e.form1,"password",t)},expression:"form1.password"}},[o("icon",{staticClass:"login-ico",attrs:{slot:"prefix",ico:"icon-3denglumima"},slot:"prefix"})],1)],1),e._v(" "),o("div",{staticClass:"login-btn"},[o("el-button",{attrs:{loading:e.btnLoading},on:{click:function(t){e.submitForm("form1")}}},[e._v("登录")])],1)],1)],1),e._v(" "),o("el-tab-pane",{attrs:{label:"手机验证登录",name:"second"}},[o("el-form",{ref:"form2",attrs:{model:e.form2,rules:e.rules,"label-width":"0px"}},[o("el-form-item",{attrs:{prop:"phone"}},[o("el-input",{staticClass:"login-inp",attrs:{size:"large",placeholder:"请输入登录手机号"},model:{value:e.form2.phone,callback:function(t){e.$set(e.form2,"phone",t)},expression:"form2.phone"}},[o("icon",{staticClass:"login-ico",attrs:{slot:"prefix",ico:"icon-zhucedengluyonghuming"},slot:"prefix"})],1)],1),e._v(" "),o("el-form-item",{staticStyle:{"margin-top":"-40px"},attrs:{prop:"code"}},[o("el-input",{staticClass:"login-inp",attrs:{size:"large",placeholder:"请输入验证码"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.submitForm("form2")}},model:{value:e.form2.code,callback:function(t){e.$set(e.form2,"code",t)},expression:"form2.code"}},[o("icon",{staticClass:"login-ico",attrs:{slot:"prefix",ico:"icon-yanzhengma"},slot:"prefix"})],1),e._v(" "),e.code?o("el-button",{staticClass:"code-btn",attrs:{type:"primary"},on:{click:e.getCode}},[e._v("获取验证码")]):o("el-button",{staticClass:"code-btn",attrs:{type:"primary"}},[e._v(e._s(e.codeTime)+"s")])],1),e._v(" "),o("div",{staticClass:"login-btn"},[o("el-button",{attrs:{loading:e.btnLoading},on:{click:function(t){e.submitForm("form2")}}},[e._v("登录")])],1)],1)],1)],1)],1)])},staticRenderFns:[]};var c=o("VU/8")(r,l,!1,function(e){o("zZ4o")},null,null);t.default=c.exports},zZ4o:function(e,t){}});