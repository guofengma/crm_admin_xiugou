webpackJsonp([84],{SEHk:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("FMx0"),i=a("P9l9"),n=a("0xDb"),r=a.n(n),l=a("19nM"),s={components:{breadcrumb:o.a},data:function(){return{p:{addFunctionModule:!0,addPrivilege:!0},nav:["权限管理","权限设置"],tableLoading:!1,isShowaddToask:!1,isShowPermission:!1,btnLoading:!1,mdLevel:[{value:"1",label:"一级"},{value:"2",label:"二级"}],first:[],tableData:[],aData:[],addModuleForm:{name:"",mdLevel:"1",first:""},addPermissionForm:{id:"",url:"",belongModule:"",perName:""},spanData:[],page:{currentPage:1,totalPage:0},rules:{url:[{required:!0,message:"请输入URL",trigger:"blur"}],perName:[{required:!0,message:"请输入权限名称",trigger:"blur"}],belongModule:[{required:!0,message:"请先添加二级模块",trigger:"blur"}]}}},created:function(){var e=window.screen.availHeight-360;this.height=e,this.pControl()},activated:function(){this.pControl(),this.getList(),this.getFirstList()},methods:{pControl:function(){for(var e in this.p)this.p[e]=r.a.pc(l[e])},getList:function(){var e=this,t=this;this.tableLoading=!0,this.$axios.post(i.queryPrivilegeList,{}).then(function(a){t.tableLoading=!1,e.aData=a.data.data,e.spanData=[],e.tableData=[];var o=0;e.aData.forEach(function(t,a){0==t.value.length?(e.spanData.push({startIndex:o,num:1}),o+=1):(e.spanData.push({startIndex:o,num:t.value.length}),o+=t.value.length)}),e.aData.forEach(function(t,a){0==t.value.length&&e.tableData.push({id:a+1,title:t.title,children:"",three:[]}),t.value.forEach(function(o,i){e.tableData.push({id:a+1,title:t.title,children:o.title,fatherId:o.id,three:o.value})})})}).catch(function(e){console.log(e),t.tableLoading=!1})},handleSizeChange:function(e){console.log("每页 "+e+" 条")},handleCurrentChange:function(e){console.log("当前页: "+e),this.page.currentPage=e,this.getList(e)},addModule:function(){this.addModuleForm={mdLevel:"1"},this.isShowaddToask=!0},confirmAddModule:function(){var e=this;if(void 0!=this.addModuleForm.name)if("2"!=this.addModuleForm.mdLevel||void 0!=this.addModuleForm.first){var t={};t.name=this.addModuleForm.name,t.url=l.addFunctionModule,"2"==this.addModuleForm.mdLevel?t.parentId=this.addModuleForm.first:t.parentId=0,this.btnLoading=!0,this.$axios.post(i.addFunctionModule,t).then(function(t){200==t.data.code?(e.$message.success(t.data.data),e.getList(),e.btnLoading=!1,e.isShowaddToask=!1):(e.btnLoading=!1,e.isShowaddToask=!1,e.$message.error(t.data.data))}).catch(function(t){e.btnLoading=!1,console.log(t)})}else this.$message.warning("请选择一级模块名称");else this.$message.warning("请输入模块名称")},getFirstList:function(){var e=this;this.$axios.post(i.queryTopMenuList,{}).then(function(t){200==t.data.code?(e.first=[],t.data.data.forEach(function(t,a){e.first.push({label:t.name,value:t.id})})):e.$message.error(t.data.msg)}).catch(function(e){console.log(e)})},addPermission:function(e){this.addPermissionForm={},this.addPermissionForm.parentId=e.fatherId,this.addPermissionForm.belongModule=e.children,this.isShowPermission=!0},confirmAddPer:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var a={};a.parentId=t.addPermissionForm.parentId,a.name=t.addPermissionForm.perName,a.uri=t.addPermissionForm.url,a.url=l.addPrivilege,t.btnLoading=!0,t.$axios.post(i.addPrivilege,a).then(function(e){200==e.data.code?(t.$message.success(e.data.data),t.getList(),t.btnLoading=!1,t.isShowaddToask=!1):(t.btnLoading=!1,t.isShowaddToask=!1,t.$message.error(e.data.msg))}).catch(function(e){t.btnLoading=!1,console.log(e)}),t.isShowPermission=!1})},mergeRow:function(e){e.row,e.column;var t=e.rowIndex,a=e.columnIndex;if(0===a||1===a){for(var o=0;o<this.spanData.length;o++)if(t===this.spanData[o].startIndex)return{rowspan:this.spanData[o].num,colspan:1};return{rowspan:0,colspan:0}}}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"set-permission"},[a("breadcrumb",{attrs:{nav:e.nav}}),e._v(" "),a("el-card",[e.p.addFunctionModule?a("el-button",{attrs:{type:"primary"},on:{click:e.addModule}},[e._v("新增功能模块")]):e._e(),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"w-table",staticStyle:{width:"100%"},attrs:{"span-method":e.mergeRow,data:e.tableData,height:e.height,border:""}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"title",label:"一级模块",width:"200",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"children",label:"二级模块",width:"200",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"three",label:"权限",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.three,function(t,o){return a("el-tag",{key:o},[e._v(e._s(t.title))])})}}])}),e._v(" "),e.p.addPrivilege?a("el-table-column",{attrs:{label:"操作",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.p.addPrivilege?a("el-button",{attrs:{type:"primary"},on:{click:function(a){e.addPermission(t.row)}}},[e._v("添加权限")]):e._e()]}}])}):e._e()],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"添加功能模块",width:"30%",visible:e.isShowaddToask},on:{"update:visible":function(t){e.isShowaddToask=t}}},[a("el-form",{ref:"addModuleForm",attrs:{rules:e.rules,model:e.addModuleForm}},[a("el-form-item",{attrs:{prop:"name",label:"模块名称"}},[a("el-input",{staticClass:"add-module-inp",model:{value:e.addModuleForm.name,callback:function(t){e.$set(e.addModuleForm,"name",t)},expression:"addModuleForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"mdLevel",label:"模块层级"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.getFirstList},model:{value:e.addModuleForm.mdLevel,callback:function(t){e.$set(e.addModuleForm,"mdLevel",t)},expression:"addModuleForm.mdLevel"}},e._l(e.mdLevel,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),"1"!=e.addModuleForm.mdLevel?a("el-form-item",{attrs:{prop:"first",label:"一级模块"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addModuleForm.first,callback:function(t){e.$set(e.addModuleForm,"first",t)},expression:"addModuleForm.first"}},e._l(e.first,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{loading:e.btnLoading,type:"primary"},on:{click:function(t){e.confirmAddModule("addModuleForm")}}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.isShowaddToask=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"添加权限",width:"30%",visible:e.isShowPermission},on:{"update:visible":function(t){e.isShowPermission=t}}},[a("el-form",{ref:"addPermissionForm",attrs:{"label-position":"right",rules:e.rules,model:e.addPermissionForm}},[a("el-form-item",{attrs:{prop:"url",label:"URL"}},[a("el-input",{staticClass:"add-module-inp",staticStyle:{"margin-left":"25px"},model:{value:e.addPermissionForm.url,callback:function(t){e.$set(e.addPermissionForm,"url","string"==typeof t?t.trim():t)},expression:"addPermissionForm.url"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"belongModule",label:"所属模块"}},[a("el-input",{staticClass:"add-module-inp",attrs:{disabled:""},model:{value:e.addPermissionForm.belongModule,callback:function(t){e.$set(e.addPermissionForm,"belongModule","string"==typeof t?t.trim():t)},expression:"addPermissionForm.belongModule"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"perName",label:"权限名称"}},[a("el-input",{staticClass:"add-module-inp",model:{value:e.addPermissionForm.perName,callback:function(t){e.$set(e.addPermissionForm,"perName","string"==typeof t?t.trim():t)},expression:"addPermissionForm.perName"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{loading:e.btnLoading,type:"primary"},on:{click:function(t){e.confirmAddPer("addPermissionForm")}}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.isShowPermission=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var u=a("VU/8")(s,d,!1,function(e){a("por8")},null,null);t.default=u.exports},por8:function(e,t){}});