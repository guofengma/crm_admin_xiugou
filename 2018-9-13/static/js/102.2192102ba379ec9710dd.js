webpackJsonp([102],{KxX2:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("mvHQ"),n=a.n(r),o=a("FMx0"),l=a("go8C"),c=a("5fic"),i=a("V3Ru"),s=(a("0xDb"),{components:{vBreadcrumb:o.a,vRemark:l.a},data:function(){return{nav:["运营管理","营销工具管理","优惠套餐","价格设置"],contents:["当出现相同产品时，填写规格的发放数量之和请勿大于该规格现有库存"],btnLoading:!1,packageCode:"",id:"",tableData:[{}],inventoryData:[],priceData:[{}],spanRow:"",spanData:[]}},activated:function(){this.packageCode=this.$route.query.packageCode||sessionStorage.getItem("packageCode"),this.id=this.$route.query.id||sessionStorage.getItem("id"),this.getPackageProInfo(),this.tableData=[{}],this.priceData=[{}]},methods:{getPackageProInfo:function(){var e=this;this.$axios.post(c.x,{packageCode:this.packageCode}).then(function(t){e.inventoryData=[],e.spanData=[],e.tableData=[],e.priceData=[];var a=0,r=t.data.data.minPrice,n=t.data.data.maxPrice;t.data.data.price?e.priceData.push(t.data.data.price):e.priceData.push({});var o=e;t.data.data.stockData.forEach(function(t,l){var c=t.specValues.split(","),i=t.productPriceId.split(","),s=t.totalStock.split(","),u=t.packageSpecValueId.split(","),p=t.leftStock.split(",");for(var d in o.spanData.push({startIndex:a,num:c.length}),a+=c.length,c){var v={packageCodeProductId:t.id,productPriceId:i[d],specValues:c[d],stock:s[d],packageSpecValueId:u[d],number:p[d],oldValue:p[d],productName:t.productName,spec:c[d],productCode:t.productCode,index:l+1};e.inventoryData.push(v)}var m={productName:t.productName,productCode:t.productCode,originalPrice:r.originalPrice+"-"+n.originalPrice+"元",v1:r.v1+"-"+n.v1+"元",v2:r.v2+"-"+n.v2+"元",v3:r.v3+"-"+n.v3+"元",v4:r.v4+"-"+n.v4+"元",groupPrice:r.groupPrice+"-"+n.groupPrice+"元",minPayment:r.minPayment+"-"+n.minPayment+"元",settlementPrice:r.settlementPrice+"-"+n.settlementPrice+"元"};e.tableData.push(m)})})},provideNum:function(e){return/^\d+$/.test(e.number)?e.number>e.oldValue&&Math.abs(e.number-e.oldValue)>Number(e.stock)?(this.$message.warning("请输入0-"+Number(Number(e.stock)+Number(e.oldValue))+"之间的数值!"),void(e.number="")):void 0:(this.$message.warning("请输入0-"+Number(e.stock)+Number(e.oldValue)+"之间的数值!"),void(e.number=""))},submitForm:function(){var e=this,t=[];this.inventoryData.forEach(function(e,a){var r={id:e.packageSpecValueId,productPriceId:e.productPriceId,stock:e.number};t.push(r)});var a=this.priceData[0];if(!(Number(a.originalPrice)>=Number(a.v1)&&Number(a.v1)>=Number(a.v2)&&Number(a.v2)>=Number(a.v3)&&Number(a.v3)>=Number(a.v4)&&Number(a.v4)>=Number(a.groupPrice)))return this.$message.warning("请输入正确的值"),void!1;var r={};r.id=this.id,r.packageCode=this.packageCode,r.originalPrice=a.originalPrice,r.v1=a.v1,r.v2=a.v2,r.v3=a.v3,r.v4=a.v4,r.groupPrice=a.groupPrice,r.minPayment=a.minPayment,r.settlementPrice=a.settlementPrice,r.stockStr=n()(t),r.url=i.updateOperActivityPackagePriceAndStock,this.btnLoading=!0,this.$axios.post(c.F,r).then(function(t){e.$message.success(t.data.msg),e.$router.push("/packageList"),e.btnLoading=!1}).catch(function(t){e.btnLoading=!1})},objectSpanMethod:function(e){e.row,e.column;var t=e.rowIndex;if(0!=e.columnIndex)return 0===t?{rowspan:this.inventoryData.length,colspan:1}:{rowspan:0,colspan:0}},mergeRow:function(e){e.row,e.column;var t=e.rowIndex,a=e.columnIndex;if(0===a||1===a){for(var r=0;r<this.spanData.length;r++)if(t===this.spanData[r].startIndex)return{rowspan:this.spanData[r].num,colspan:1};return{rowspan:0,colspan:0}}},backToList:function(){this.$router.push("/packageList")}}}),u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"price-inventory"},[a("v-breadcrumb",{attrs:{nav:e.nav}}),e._v(" "),a("el-card",{attrs:{"body-style":{padding:"20px 45px"}}},[a("div",{staticClass:"pro-title"},[e._v("发放库存设置")]),e._v(" "),a("v-remark",{attrs:{contents:e.contents}}),e._v(" "),a("el-table",{staticClass:"inventory-table",attrs:{data:e.inventoryData,border:"","span-method":e.mergeRow}},[a("el-table-column",{attrs:{prop:"index",label:"产品序号",align:"center",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productName",label:"产品名称",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"spec",label:"产品规格",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"stock",label:"现有库存",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"发放数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{on:{blur:function(a){e.provideNum(t.row)}},model:{value:t.row.number,callback:function(a){e.$set(t.row,"number",a)},expression:"scope.row.number"}})]}}])})],1),e._v(" "),a("div",{staticClass:"pro-title"},[e._v("售价设置")]),e._v(" "),a("el-table",{attrs:{data:e.tableData,border:"","span-method":e.objectSpanMethod}},[a("el-table-column",{attrs:{prop:"productName",label:"产品名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.productName)),a("br"),e._v(e._s("产品ID:"+t.row.productCode)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"originalPrice",label:"原价",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"v1",label:"V1价",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"v2",label:"V2价",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"v3",label:"V3价",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"v4",label:"V4价",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"groupPrice",label:"拼店价",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"minPayment",label:"最低支付价",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"settlementPrice",label:"结算价",align:"center"}})],1),e._v(" "),a("div",{staticClass:"package-price"},[e._v("套餐价")]),e._v(" "),a("el-table",{staticClass:"price-area",attrs:{data:e.priceData,border:""}},[a("el-table-column",{attrs:{label:"原价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.originalPrice,callback:function(a){e.$set(t.row,"originalPrice",a)},expression:"scope.row.originalPrice"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"V1价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.v1,callback:function(a){e.$set(t.row,"v1",a)},expression:"scope.row.v1"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"V2价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.v2,callback:function(a){e.$set(t.row,"v2",a)},expression:"scope.row.v2"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"V3价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.v3,callback:function(a){e.$set(t.row,"v3",a)},expression:"scope.row.v3"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"V4价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.v4,callback:function(a){e.$set(t.row,"v4",a)},expression:"scope.row.v4"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"拼店价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.groupPrice,callback:function(a){e.$set(t.row,"groupPrice",a)},expression:"scope.row.groupPrice"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"最低支付价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.minPayment,callback:function(a){e.$set(t.row,"minPayment",a)},expression:"scope.row.minPayment"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"结算价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.settlementPrice,callback:function(a){e.$set(t.row,"settlementPrice",a)},expression:"scope.row.settlementPrice"}})]}}])})],1),e._v(" "),a("div",{staticClass:"clearfix"}),e._v(" "),a("div",{staticClass:"btn-group"},[a("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:e.submitForm}},[e._v("确认")]),e._v(" "),a("el-button",{on:{click:e.backToList}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(s,u,!1,function(e){a("U6CG")},"data-v-4fc44c80",null);t.default=p.exports},U6CG:function(e,t){}});