webpackJsonp([90],{"Rl/H":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("FMx0"),i=s("P9l9"),n=s("19nM"),r={components:{breadcrumb:a.a},data:function(){return{nav:["权限管理","岗位权限管理","编辑岗位"],checkAllUser:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],isIndeterminateUser:!1,checkedUser:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],userManList:[],getUserPriList:[],id:"",departmentName:"",form:{department:[],name:""},rules:{name:{required:!0,message:"请选择所在岗位",trigger:"blur"}}}},created:function(){this.getCreatedMsg()},activated:function(){this.getCreatedMsg()},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var s={},a=[];t.checkedUser.forEach(function(e,t){e.forEach(function(e){a.push(e)})}),s.role=a.join(","),s.id=t.id,s.name=t.form.name,s.url=n.updateRole,t.$axios.post(i.updateRole,s).then(function(e){t.$message.success(e.data.data),t.$router.push("/jobsPermissionMange")}).catch(function(e){console.log(e)})})},goBack:function(){this.$router.push("/jobsPermissionMange")},assemblyData:function(){var e=this;this.checkedUser=[];for(var t=0;t<this.userManList.length+1;t++)this.checkedUser.push([]);this.userManList.forEach(function(t,s){var a=0;t.value.forEach(function(t,i){t.value.forEach(function(t,i){a++,-1!=e.getUserPriList.indexOf(t.id)&&e.checkedUser[s].push(t.id)})}),a==e.checkedUser[s].length&&(e.checkAllUser[s]=!0)})},handleCheckAllChangeUser:function(e,t){var s=[];this.userManList[t].value.forEach(function(e){e.value.forEach(function(e){s.push(e.id)})}),this.checkedUser[t]=e?s:[]},handleCheckedUserChange:function(e,t){var s=[],a=e.length;this.userManList[t].value.forEach(function(e){e.value.forEach(function(e){s.push(e.value)})}),this.checkAllUser[t]=a==s.length,this.$set(this.checkAllUser,t,this.checkAllUser[t])},getRoleList:function(){var e=this;this.$axios.post(i.getRoleList,{}).then(function(t){e.userManList=t.data.data}).catch(function(e){console.log(e)})},getCreatedMsg:function(){var e=this;this.getRoleList(),this.checkAllUser=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],this.id=this.$route.params.userId||sessionStorage.getItem("editJobsPermission"),this.$axios.post(i.findRoleById,{id:this.id}).then(function(t){if(200==t.data.code){e.form.department=[],e.getUserPriList=[],e.form.name=t.data.data.name,e.departmentName=t.data.data.deptmentName,t.data.data.rolePrivilegeList.forEach(function(t,s){e.getUserPriList.push(t.privilegeId)});var s=e;setTimeout(function(){s.assemblyData()},500)}else e.$message.warning(t.data.msg)}).catch(function(e){console.log(e)})}}},c={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("breadcrumb",{attrs:{nav:e.nav}}),e._v(" "),s("el-card",[s("div",{staticClass:"add-box"},[s("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"100px"}},[s("span",{staticClass:"add-box-title"},[e._v("基础信息")]),e._v(" "),s("el-form-item",{attrs:{prop:"name",label:"所在岗位"}},[s("el-input",{staticStyle:{width:"220px"},attrs:{placeholder:"请选择"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),s("el-form-item",{attrs:{prop:"department",label:"所属部门"}},[e._v("\n                  "+e._s(e.departmentName)+"\n                ")]),e._v(" "),s("hr",{staticClass:"add-box-sep",attrs:{width:"90%",size:"1",color:"#ccc"}}),e._v(" "),s("span",{staticClass:"add-box-title"},[e._v("权限设置")]),e._v(" "),e._l(e.userManList,function(t,a){return s("el-collapse",{key:a,attrs:{accordion:""}},[s("el-collapse-item",[s("template",{slot:"title"},[s("el-checkbox",{staticClass:"collapse-tit",on:{change:function(t){e.handleCheckAllChangeUser(e.checkAllUser[a],a)}},model:{value:e.checkAllUser[a],callback:function(t){e.$set(e.checkAllUser,a,t)},expression:"checkAllUser[k]"}},[e._v(e._s(t.title))])],1),e._v(" "),s("el-checkbox-group",{on:{change:function(t){e.handleCheckedUserChange(e.checkedUser[a],a)}},model:{value:e.checkedUser[a],callback:function(t){e.$set(e.checkedUser,a,t)},expression:"checkedUser[k]"}},e._l(t.value,function(t,a){return s("div",{key:a},[s("div",{staticClass:"collapse-title"},[e._v(e._s(t.title))]),e._v(" "),s("div",{staticStyle:{overflow:"hidden","margin-bottom":"10px"}},[s("div",{staticClass:"collapse-item"},e._l(t.value,function(t,a){return s("el-checkbox",{key:a,attrs:{label:t.id}},[e._v(e._s(t.title))])}))])])}))],2)],1)}),e._v(" "),s("el-form-item",{staticClass:"sub-btn"},[s("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(t){e.submitForm("form")}}},[e._v("提交")]),e._v(" "),s("el-button",{attrs:{size:"medium"},on:{click:e.goBack}},[e._v("重置")])],1)],2)],1)])],1)},staticRenderFns:[]};var o=s("VU/8")(r,c,!1,function(e){s("s6kX")},null,null);t.default=o.exports},s6kX:function(e,t){}});