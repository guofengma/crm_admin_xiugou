webpackJsonp([143],{UYji:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("mvHQ"),l=a.n(r),i=a("FMx0"),s=a("DAYN"),o=a.n(s),n=a("yPE/"),c=a.n(n),u=a("UU1J"),d=a("X3nD"),m=a("4cBs"),h=a("0xDb"),f=a.n(h),g={components:{draggable:o.a,vBreadcrumb:i.a,icon:u.a},data:function(){return{nav:["品牌产品管理","产品管理","发布产品"],isUseUpload:!1,showSaleTime:!1,uploadImg:"",imgArr:[],itemList:[],brandArr:[],freightTemplateArr:[],supplierArr:[],shipperArr:[{label:"平台发货",value:"1"},{label:"供应商发货",value:"2"}],aferServiceDays:[{label:"无售后服务",value:"0"},{label:"到货后7天",value:"7"},{label:"到货后15天",value:"15"},{label:"到货后30天",value:"30"},{label:"到货后6个月",value:"180"},{label:"到货后1年",value:"365"},{label:"到货后2年",value:"730"},{label:"到货后3年",value:"1095"}],itemProps:{value:"value",children:"children"},proCategoryArr:[],form:{name:"",firstCategoryId:"",secCategoryId:"",brandId:"",supplierId:"",sendfrom:"",weight:"",volume:"",freightTemplateId:"",aferServiceDays:"",content:"",tagId:"",originalImg:"",smallImg:""},productParam:[],editorOption:{placeholder:"请输入内容",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image"]]}},uploadData:{},uploadType:"",selectedTagArr:[],tagArr:[],tagName:"",proItemArr:[]}},computed:{qnLocation:function(){return location.protocol,d.a}},activated:function(){this.uploadImg=d.a,this.imgArr=[],this.proItemArr=[],this.selectedTagArr=[],this.getFirstItem(),this.getFreightTemplate(),this.getAllTags(),f.a.cleanFormData(this.form)},mounted:function(){this.$refs.myQuillEditor.quill.getModule("toolbar").addHandler("image",this.imgHandler)},methods:{beforeSubmit:function(){return 0==this.imgArr.length?(this.$message.warning("请添加产品图片"),!1):0==this.selectedTagArr.length?(this.$message.warning("请添加产品标签"),!1):parseInt(this.form.weight)>=0?parseInt(this.form.volume)>=0?0!=this.productParam.length||(this.$message.warning("请输入产品参数"),!1):(this.$message.warning("请输入正确的体积"),!1):(this.$message.warning("请输入正确的重量"),!1)},submitForm:function(){var e=this;if(this.beforeSubmit()){var t=[],a=[],r=[];this.selectedTagArr.forEach(function(e,a){t.push(e.value)}),this.form.tagId=t.join(","),this.imgArr.forEach(function(e,t){a.push(e.smallUrl),r.push(e.originUrl)}),this.form.smallImg=l()(a),this.form.originalImg=l()(r),this.form.type=2;var i={};(i=this.form).url=m.a;var s=[];this.productParam.forEach(function(e,t){s.push({parmId:e.id,parmValue:e.value})}),i.specStr=l()(s),this.$axios.post(d.b,i).then(function(t){e.$message.success(t.data.data),e.$router.push("/productList")}).catch(function(e){console.log(e)})}},beforeUploadArr:function(){this.$message.warning("上传中...")},getdata:function(e){},datadragEnd:function(e){},successUpload:function(e){if(200==e.code){if(this.imgArr.length>=5)return this.isUseUpload=!0,void this.$message.warning("最多只能上传五张图片");this.imgArr.push({originUrl:e.data.imageUrl,smallUrl:e.data.imageThumbUrl}),this.$message.success("上传成功")}else this.$message.warning(e.data.msg)},deleteImg:function(e){var t=-1;this.imgArr.forEach(function(a,r){a.originUrl==e.originUrl&&(t=r)}),-1!=t&&(this.imgArr.splice(t,1),this.imgArr.length<5&&(this.isUseUpload=!1))},defSaleTime:function(){this.form.aferServiceDays="",this.showSaleTime=!this.showSaleTime},onEditorChange:function(e){e.editor;var t=e.html;e.text;this.form.content=t},upScuccess:function(e,t,a){this.fullscreenLoading=!1;var r=this,l="";if("image"===this.uploadType&&(l=e.data.imageUrl,this.form.original_img=e.data.imageUrl,this.form.small_img=e.data.imageThumbUrl),null!=l&&l.length>0){var i=l;r.addRange=r.$refs.myQuillEditor.quill.getSelection(),i=-1!==i.indexOf("http")?i:"http:"+i,r.$refs.myQuillEditor.quill.insertEmbed(null!==r.addRange?r.addRange.index:0,r.uploadType,i,c.a.sources.USER),this.$message.success("插入成功")}else this.$message.error(r.uploadType+"插入失败");this.$refs.upload.clearFiles()},imgHandler:function(e){(this.addRange=this.$refs.myQuillEditor.quill.getSelection(),e)&&document.getElementById("imgInput").click();this.uploadType="image"},handleClose:function(e,t){var a=this;this.selectedTagArr.splice(e,1),this.tagArr.forEach(function(e,r){t.label==e.label&&(a.tagArr[r].selected=!1)})},addTag:function(){var e=this;if(""!=this.tagName){var t=!1;if(this.tagArr.forEach(function(a,r){e.tagName==a.label&&(t=!0)}),t)this.$message.warning("标签已经添加，请不要重复添加!");else{var a={};a.name=this.tagName,a.url=m.a,a.type=2,this.$axios.post(d.e,a).then(function(t){e.$message.success("添加成功!"),e.tagName="",e.getAllTags()}).catch(function(e){console.log(e)})}}else this.$message.warning("请输入正确的标签")},insertTag:function(e){this.selectedTagArr.length>19?this.$message.warning("最多添加20个标签"):(e.selected=!0,this.selectedTagArr.push({label:e.label,value:e.value}))},getFirstItem:function(){var e=this;this.itemList=[],this.$axios.post(d.h,{fatherid:0,pageSize:1e6,url:m.a}).then(function(t){t.data.data.data.forEach(function(t,a){e.itemList.push({label:t.name,value:t.id,children:[]}),e.handleItemChange(t.id)})}).catch(function(e){console.log(e)})},handleItemChange:function(e){var t=this,a=0;this.itemList.forEach(function(t,r){t.value==e&&(a=r)});var r={};r.fatherid=e,r.pageSize=1e6,r.url=m.a,this.itemList[a].children=[],this.$axios.post(d.h,r).then(function(e){e.data.data.data.forEach(function(e,r){t.itemList[a].children.push({label:e.name,value:e.id})})}).catch(function(e){console.log(e)})},getProItemId:function(e){var t=this;this.form.brandId="";var a=this.form.secCategoryId=e[1];this.form.firstCategoryId=e[0],this.form.secCategoryId=e[1],this.brandArr=[],this.getProductParam(e[1]),this.$axios.post(d.k,{cId:a,pageSize:1e6,url:m.a}).then(function(e){e.data.data.forEach(function(e,a){t.brandArr.push({label:e.name,value:e.id})})}).catch(function(e){console.log(e)})},getSupplyList:function(){var e=this;this.supplierId="";var t={};this.supplierArr=[],t.firstCategoryId=this.form.firstCategoryId,t.secCategoryId=this.form.secCategoryId,t.brandId=this.form.brandId,t.pageSize=1e6,t.url=m.a,this.$axios.post(d.p,t).then(function(t){t.data.data.forEach(function(t,a){e.supplierArr.push({label:t.name,value:t.supplier_id})})}).catch(function(e){console.log(e)})},getFreightTemplate:function(){var e=this;this.freightTemplateArr=[],this.$axios.post(d.i,{url:m.a}).then(function(t){t.data.data.forEach(function(t,a){e.freightTemplateArr.push({label:t.name,value:t.id})})}).catch(function(e){console.log(e)})},getAllTags:function(){var e=this;this.tagArr=[],this.$axios.post(d.q,{url:m.a,type:2}).then(function(t){t.data.data.forEach(function(t,a){e.tagArr.push({label:t.name,value:t.id})}),e.tagArr.forEach(function(t,a){e.selectedTagArr.forEach(function(e,a){t.value==e.value&&(t.selected=!0)})})}).catch(function(e){console.log(e)})},getProductParam:function(e){var t=this;this.$axios.post(d.j,{categoryId:e}).then(function(e){t.productParam=[],e.data.data.forEach(function(e,a){e.value="",t.productParam.push(e)})})}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"release-product"},[a("v-breadcrumb",{attrs:{nav:e.nav}}),e._v(" "),a("el-card",{attrs:{"body-style":{padding:"20px 45px",color:"#666"}}},[a("div",{staticClass:"pro-title"},[e._v("基本信息")]),e._v(" "),a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"产品名称"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{maxlength:16,placeholder:"请输入产品名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"产品图片"}},[a("draggable",{staticStyle:{display:"inline-block"},attrs:{move:e.getdata},on:{update:e.datadragEnd},model:{value:e.imgArr,callback:function(t){e.imgArr=t},expression:"imgArr"}},[a("transition-group",e._l(e.imgArr,function(t,r){return a("div",{key:r,staticClass:"img-wrap"},[a("div",{staticClass:"delImg",on:{click:function(a){e.deleteImg(t)}}},[a("icon",{attrs:{ico:"icon-shanchu"}})],1),e._v(" "),a("img",{staticClass:"uImg",attrs:{src:t.originUrl}})])}))],1),e._v(" "),a("el-upload",{staticClass:"img-uploader",attrs:{"before-upload":e.beforeUploadArr,action:e.uploadImg,"show-file-list":!1,"on-success":e.successUpload,disabled:e.isUseUpload,multiple:""}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),a("div",{staticClass:"upload-tip"},[e._v("建议尺寸：800*800,拖拽图片可以改变顺序，第一张为默认头图")])],1),e._v(" "),a("el-form-item",{attrs:{label:"产品分类"}},[a("el-cascader",{attrs:{filterable:"",options:e.itemList,props:e.itemProps},on:{change:e.getProItemId},model:{value:e.proItemArr,callback:function(t){e.proItemArr=t},expression:"proItemArr"}}),e._v(" "),a("span",{staticStyle:{"margin-left":"30px"}},[e._v("产品品牌")]),e._v(" "),a("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:e.getSupplyList},model:{value:e.form.brandId,callback:function(t){e.$set(e.form,"brandId",t)},expression:"form.brandId"}},e._l(e.brandArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"供应商"}},[a("el-select",{attrs:{placeholder:"下拉搜索供应商"},model:{value:e.form.supplierId,callback:function(t){e.$set(e.form,"supplierId",t)},expression:"form.supplierId"}},e._l(e.supplierArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"发货方"}},[a("el-select",{attrs:{placeholder:"选择发货方"},model:{value:e.form.sendfrom,callback:function(t){e.$set(e.form,"sendfrom",t)},expression:"form.sendfrom"}},e._l(e.shipperArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"产品重量"}},[a("el-input",{staticClass:"pro-weight",model:{value:e.form.weight,callback:function(t){e.$set(e.form,"weight",t)},expression:"form.weight"}}),e._v("kg\n          ")],1),e._v(" "),a("el-form-item",{attrs:{label:"产品体积"}},[a("el-input",{staticClass:"pro-weight",model:{value:e.form.volume,callback:function(t){e.$set(e.form,"volume",t)},expression:"form.volume"}}),e._v("m³\n          ")],1),e._v(" "),a("el-form-item",{attrs:{label:"产品参数"}},[a("div",{staticClass:"product-param"},[0==e.productParam.length?a("span",[e._v("暂无数据")]):e._l(e.productParam,function(t,r){return a("span",{key:r},[e._v(e._s(t.parm)+"："),a("el-input",{staticClass:"inp-param",model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"v.value"}})],1)})],2)]),e._v(" "),a("div",{staticClass:"pro-title"},[e._v("基本信息")]),e._v(" "),a("el-form-item",{attrs:{label:"选择运费模板"}},[a("el-select",{attrs:{placeholder:"请选择模板"},model:{value:e.form.freightTemplateId,callback:function(t){e.$set(e.form,"freightTemplateId",t)},expression:"form.freightTemplateId"}},e._l(e.freightTemplateArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"售后周期"}},[a("transition",{attrs:{name:"fade"}},[e.showSaleTime?e._e():a("el-select",{attrs:{placeholder:"请选择售后周期"},model:{value:e.form.aferServiceDays,callback:function(t){e.$set(e.form,"aferServiceDays",t)},expression:"form.aferServiceDays"}},e._l(e.aferServiceDays,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),e._v(" "),e.showSaleTime?a("el-input",{staticStyle:{width:"215px"},attrs:{placeholder:"请输入售后周期"},model:{value:e.form.aferServiceDays,callback:function(t){e.$set(e.form,"aferServiceDays",t)},expression:"form.aferServiceDays"}}):e._e()],1),e._v(" "),a("el-button",{on:{click:e.defSaleTime}},[e._v("自定义")])],1),e._v(" "),a("div",{staticClass:"pro-title"},[e._v("产品信息")]),e._v(" "),a("quill-editor",{ref:"myQuillEditor",attrs:{options:e.editorOption},on:{change:function(t){e.onEditorChange(t)}},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}}),e._v(" "),a("el-upload",{ref:"upload",staticStyle:{display:"none"},attrs:{action:e.qnLocation,data:e.uploadData,"on-success":e.upScuccess}},[a("el-button",{attrs:{size:"small",type:"primary",id:"imgInput","element-loading-text":"插入中,请稍候"}},[e._v("点击上传")])],1),e._v(" "),a("div",{staticClass:"selected-tag"},[0==e.selectedTagArr.length?a("span",{staticClass:"tag-tip"},[e._v("请选择标签")]):e._e(),e._v(" "),e._l(e.selectedTagArr,function(t,r){return a("el-tag",{key:r,staticClass:"tag",attrs:{type:"info",closable:""},on:{close:function(a){e.handleClose(r,t)}}},[e._v(e._s(t.label))])})],2),e._v(" "),a("div",{staticClass:"add-tag"},[a("el-input",{staticStyle:{width:"215px","margin-right":"20px"},attrs:{placeholder:"请输入标签/至多可添加20个"},model:{value:e.tagName,callback:function(t){e.tagName=t},expression:"tagName"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addTag}},[e._v("添加标签")])],1),e._v(" "),a("div",{staticClass:"tag-list"},[0==e.tagArr.length?a("span",{staticClass:"tag-tip"},[e._v("请添加标签")]):e._e(),e._v(" "),e._l(e.tagArr,function(t,r){return a("el-button",{key:r,class:{"selected-btn":t.selected},staticStyle:{"margin-bottom":"10px"},attrs:{disabled:t.selected},on:{click:function(a){e.insertTag(t)}}},[e._v(e._s(t.label))])})],2),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确认发布")]),e._v(" "),a("el-button",[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var v=a("VU/8")(g,p,!1,function(e){a("tm77")},null,null);t.default=v.exports},tm77:function(e,t){}});