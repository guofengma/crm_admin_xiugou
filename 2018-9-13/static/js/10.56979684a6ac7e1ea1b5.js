webpackJsonp([10],{"2e+M":function(t,e){},"6mLW":function(t,e,s){"use strict";var i=s("mvHQ"),a=s.n(i),r=s("UU1J"),d=s("GVVA"),o={components:{icon:r.a},props:["getProducts","isOnly"],data:function(){return{first:[],second:[],third:[],productList:[],firstCategoryId:"",secCategoryId:"",thirdCategoryId:"",productId:"",firstCategoryName:"",secCategoryName:"",thirdCategoryName:"",productName:"",loading:!1,firstClassifyTag:{},secondClassifyTag:{},thirdClassifyTag:{},productTag:{}}},watch:{getProducts:function(t){this.resetValue(),t.firstCategoryIds?(this.firstCategoryId=t.firstCategoryIds,this.firstCategoryName=t.firstCategoryNames,this.firstClassifyTag={id:this.firstCategoryId,name:this.firstCategoryName}):(this.firstCategoryId="",this.firstCategoryNames=""),t.secCategoryIds?(this.secCategoryId=t.secCategoryIds,this.secCategoryName=t.secCategoryNames,this.secondClassifyTag={id:this.secCategoryId,name:this.secCategoryName}):(this.secCategoryId="",this.secCategoryName=""),t.thirdCategoryIds?(this.thirdCategoryId=t.thirdCategoryIds,this.thirdCategoryName=t.thirdCategoryNames,this.thirdClassifyTag={id:this.thirdCategoryId,name:this.thirdCategoryName}):(this.thirdCategoryId="",this.thirdCategoryName=""),t.products?(this.productId=t.products,this.productName=t.productNames,this.productTag={id:this.productId}):this.productId="",this.getFirst(),this.isOnly&&(this.getSecond(this.firstClassifyTag,!1),this.getProductList(this.secondClassifyTag,!1))}},created:function(){this.getFirst(),this.resetValue()},methods:{resetValue:function(){this.firstClassifyTag={},this.secondClassifyTag={},this.thirdClassifyTag={},this.productTag={}},getFirst:function(){var t=this;t.loading=!0;d.a.queryProductCategoryList({page:1,pageSize:1e4,level:1,fatherId:0}).then(function(e){t.first=e.data,t.loading=!1}).catch(function(e){console.log(e),t.loading=!1})},getSecond:function(t,e){var s=this;e&&(s.firstCategoryName=t.name,s.firstClassifyTag=[],s.second=[],s.third=[],s.productList=[],s.secondClassifyTag=[],s.thirdClassifyTag=[],s.productTag=[]),s.firstCategoryId=t.id;var i={fatherId:t.id,page:1,pageSize:1e4,level:2};s.loading=!1,d.a.queryProductCategoryList(i).then(function(t){s.second=t.data}).catch(function(t){console.log(t),s.loading=!1}),this.transValue()},getThird:function(t,e){var s=this;e&&(s.secCategoryName=t.name,s.firstClassifyTag=[],s.second=[],s.third=[],s.productList=[],s.secondClassifyTag=[],s.thirdClassifyTag=[],s.productTag=[]),s.secCategoryId=t.id;var i={fatherId:t.id,page:1,pageSize:1e4,level:3};s.loading=!1,d.a.queryProductCategoryList(i).then(function(t){s.third=t.data}).catch(function(t){console.log(t),s.loading=!1}),this.transValue()},getProductList:function(t,e){var s=this;e&&(s.productList=[],s.productTag=[],s.products=[],s.thirdClassifyTag=t),s.thirdCategoryId=t.id;var i={page:1,pageSize:1e4,firstCategoryId:s.firstCategoryId,secCategoryId:s.secCategoryId,thirdCategoryId:s.thirdCategoryId};s.loading=!1,d.a.queryProductPageList(i).then(function(t){s.productList=t.data,s.loading=!1}).catch(function(t){console.log(t),s.loading=!1}),this.transValue()},chooseProduct:function(t){this.productTag=t,this.productName=t.name,this.productId=t.id,this.transValue()},deleteTags:function(t){1===t?(this.firstCategoryName="",this.firstClassifyTag={},this.second=[],this.third=[],this.productList=[],this.deleteTags(2),this.deleteTags(3),this.deleteTags(4)):2===t?(this.secCategoryName="",this.secondClassifyTag={},this.secondClassifyTag={},this.productList=[],this.deleteTags(3),this.deleteTags(4)):3===t?(this.secCategoryName="",this.secondClassifyTag={},this.secondClassifyTag={},this.productList=[],this.deleteTags(4)):(this.productName="",this.productTag={})},transValue:function(){var t={firstCategoryIds:this.firstCategoryId,secCategoryIds:this.secCategoryId,thirdCategoryIds:this.thirdCategoryId,products:this.productId};this.$emit("getProductIds",a()(t))}}},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"choose-box"},[s("div",{staticStyle:{"margin-top":"10px"}},[s("div",{staticClass:"check-area"},[s("div",{staticClass:"title"},[t._v("一级类目")]),t._v(" "),s("div",{staticClass:"data-area"},[s("el-radio-group",{model:{value:t.firstCategoryName,callback:function(e){t.firstCategoryName=e},expression:"firstCategoryName"}},t._l(t.first,function(e,i){return s("div",{key:i},[s("el-radio",{attrs:{label:e.name,value:e.id},on:{change:function(s){t.getSecond(e,!0)}}})],1)}))],1)]),t._v(" "),s("div",{staticClass:"check-area"},[s("div",{staticClass:"title"},[t._v("二级类目")]),t._v(" "),t.second.length>0?s("div",{staticClass:"data-area"},[s("el-radio-group",{model:{value:t.secCategoryName,callback:function(e){t.secCategoryName=e},expression:"secCategoryName"}},t._l(t.second,function(e,i){return s("div",{key:i},[s("el-radio",{attrs:{label:e.name,value:e.id},on:{change:function(s){t.getThird(e,!0)}}})],1)}))],1):s("div",{staticClass:"nodata"},[t._v("\n                暂无数据~\n            ")])]),t._v(" "),s("div",{staticClass:"check-area"},[s("div",{staticClass:"title"},[t._v("三级类目")]),t._v(" "),t.third.length>0?s("div",{staticClass:"data-area"},[s("el-radio-group",{model:{value:t.secCategoryName,callback:function(e){t.secCategoryName=e},expression:"secCategoryName"}},t._l(t.third,function(e,i){return s("div",{key:i},[s("el-radio",{attrs:{label:e.name,value:e.id},on:{change:function(s){t.getProductList(e,!0)}}})],1)}))],1):s("div",{staticClass:"nodata"},[t._v("\n                暂无数据~\n            ")])]),t._v(" "),s("div",{staticClass:"check-area"},[s("div",{staticClass:"title"},[t._v("产品\n                "),s("el-input",{attrs:{placeholder:"请输入产品名称或者ID进行查找","suffix-icon":"el-icon-search"}})],1),t._v(" "),t.productList.length>0?s("div",{staticClass:"data-area"},[s("el-radio-group",{model:{value:t.productName,callback:function(e){t.productName=e},expression:"productName"}},t._l(t.productList,function(e,i){return s("div",{key:i,staticClass:"product-list"},[s("el-radio",{attrs:{value:e.id,label:e.name},on:{change:function(s){t.chooseProduct(e,i)}}}),t._v(" "),s("span",{staticClass:"product-item"},[t._v("产品ID:"+t._s(e.id)+" "),s("span",{staticClass:"product-name"},[t._v(t._s(e.name))])])],1)}))],1):s("div",{staticClass:"nodata"},[t._v("\n                暂无数据~\n            ")])]),t._v(" "),s("div",{staticClass:"clearfix"}),t._v(" "),s("div",{staticStyle:{"margin-top":"10px"}},[t.firstClassifyTag.name?s("div",[t._v("\n                一级类目：\n                "),s("el-tag",{attrs:{closable:""},on:{close:function(e){t.deleteTags(1)}}},[t._v("\n                    "+t._s(t.firstClassifyTag.name)+"\n                ")])],1):t._e(),t._v(" "),t.secondClassifyTag.name?s("div",[t._v("\n                二级类目：\n                "),s("el-tag",{attrs:{closable:""},on:{close:function(e){t.deleteTags(2)}}},[t._v("\n                    "+t._s(t.secondClassifyTag.name)+"\n                ")])],1):t._e(),t._v(" "),t.thirdClassifyTag.name?s("div",[t._v("\n                三级类目：\n                "),s("el-tag",{attrs:{closable:""},on:{close:function(e){t.deleteTags(3)}}},[t._v("\n                    "+t._s(t.thirdClassifyTag.name)+"\n                ")])],1):t._e(),t._v(" "),t.productTag.id?s("div",[t._v("\n                产品ID：\n                "),s("el-tag",{attrs:{closable:""},on:{close:function(e){t.deleteTags(4)}}},[t._v("\n                    "+t._s(t.productTag.id)+"\n                ")])],1):t._e()])])])},staticRenderFns:[]};var c=s("VU/8")(o,n,!1,function(t){s("2e+M")},"data-v-232a0c97",null);e.a=c.exports},MrZ7:function(t,e){},ZZCZ:function(t,e){},hv71:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("FMx0"),a=s("s/ju"),r=s("6mLW"),d=s("UU1J"),o=s("0xDb"),n=s.n(o),c=s("GVVA"),l={components:{vBreadcrumb:i.a,vOnlychoose:r.a,icon:d.a,vMultichoose:a.a},data:function(){return{nav:["运营管理","优惠券设置","添加优惠券"],checkAll:!1,checkedUsers:[],users:[],isIndeterminate:!1,form:{name:"",type:"",value:"",discountCouponTemplateId:"",totalNumber:"",maxDealerGetNumber:"",remark:""},typeArr:[{name:"满减券(商品满额可用)",type:1},{name:"抵价券(商品直接抵价)",type:2},{name:"折扣券(打折百分比券)",type:3},{name:"抵扣券",type:4}],discountArr:[{name:"1折",type:10},{name:"2折",type:20},{name:"3折",type:30},{name:"4折",type:40},{name:"5折",type:50},{name:"6折",type:60},{name:"7折",type:70},{name:"8折",type:80},{name:"9折",type:90}],tempArr:[],expirationReminder:"",data:{totalNumber:"",maxDealerGetNumber:""},totalNumber:!1,maxDealerGetNumber:!1,productList:[],day:"",monthOrWeek:"",type:"3",isDay:!1,tipInf:"月",useConditions:"",btnLoading:!1}},activated:function(){n.a.cleanFormData(this.form),this.getLevelList(),this.queryTemplateList(),this.isIndeterminate=!1,this.checkAll=!1,this.maxDealerGetNumber=!1,this.totalNumber=!1,this.productList=[],this.day="",this.monthOrWeek="",this.type="3",this.isDay=!1,this.tipInf="月",this.useConditions="",this.expirationReminder="",this.checkedUsers=[],this.getProducts={}},methods:{queryTemplateList:function(){var t=this;c.a.queryTemplateList({}).then(function(e){t.tempArr=e.data}).catch(function(t){console.log(t)})},changeType:function(){this.tipInf=3==this.type?"月":"周"},getLevelList:function(){var t=this;c.a.getUserLevelList({}).then(function(e){t.users=e.data}).catch(function(t){console.log(t)})},handleCheckAllChange:function(t){if(this.checkedUsers=t?this.users:[],this.isIndeterminate=!1,t){for(var e="",s=0;s<this.users.length;s++)e+=this.users[s].id+",";this.form.dealerLevelIds=e.slice(0,-1)}else this.form.dealerLevelIds=""},handleCheckedUsersChange:function(t){var e=t.length,s="";for(var i in this.users)for(var a in t)this.users[i].id==t[a].id&&(s+=this.users[i].id+",");this.form.dealerLevelIds=s.slice(0,-1),this.checkAll=e===this.users.length,this.isIndeterminate=e>0&&e<this.users.length},getProductIds:function(t){t&&(this.productList=JSON.parse(t))},submitForm:function(){var t=this,e=this.form;if(e.name)if(e.type)if(e.value)if(e.discountCouponTemplateId)if(this.useConditions?e.useConditions=this.useConditions:e.useConditions=0,this.isDay?(e.periodType=this.type,e.period=this.monthOrWeek,e.hadPeriod=1):(e.periodType=1,e.period=this.day,e.hadPeriod=0),e.period){if(4==this.form.type){if(!t.productList.firstCategoryIds||!t.productList.secCategoryIds||!t.productList.products)return void this.$message.warning("请选择可用品类!");e.firstCategoryIds=t.productList.firstCategoryIds,e.secCategoryIds=t.productList.secCategoryIds,e.productIds=t.productList.products,e.categoryType=5}else{var s=[],i=[],a=[];if(s=t.productList.firstCategoryIds,i=t.productList.secCategoryIds,a=t.productList.products,0==t.productList.length)return void this.$message.warning("请选择可用品类!");if(0==s.length&&0==i.length&&0==a.length)return void this.$message.warning("请选择可用品类!");t.productList.checkAll?e.categoryType=1:0==s.length&&0==i.length&&1==a.length?e.categoryType=5:0==s.length&&0==i.length&&a.length>1?e.categoryType=4:(1==s.length&&0==i.length||0==s.length&&1==i.length)&&0==a.length?e.categoryType=3:e.categoryType=2,e.firstCategoryIds=s.length?s.join(","):"",e.secCategoryIds=i.length?i.join(","):"",e.productIds=a.length?a.join(","):""}if(e.dealerLevelIds){if(t.totalNumber)e.totalNumber=-1;else if(!e.totalNumber)return void this.$message.warning("请输入发放数量!");if(t.maxDealerGetNumber)e.maxDealerGetNumber=-1;else if(!e.totalNumber)return void this.$message.warning("请输入每人限额!");t.expirationReminder?e.expirationReminder=1:e.expirationReminder=0,t.btnLoading=!0,c.a.addOrModifyCoupon(e).then(function(e){t.$router.push("/discountCoupon"),t.btnLoading=!1}).catch(function(e){console.log(err),t.btnLoading=!1})}else this.$message.warning("请选择可使用用户层级!")}else this.$message.warning("请输入可用周期数据!");else this.$message.warning("请选择券模板!");else 3!=e.type?this.$message.warning("请输入券值!"):this.$message.warning("请选中折扣值!");else this.$message.warning("请选择优惠券类型!");else this.$message.warning("请输入优惠券名称!")},cancel:function(){this.$router.push("/discountCoupon")}}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"add-coupon"},[s("v-breadcrumb",{attrs:{nav:t.nav}}),t._v(" "),s("el-card",{attrs:{"body-style":{padding:"20px 45px",color:"#666"}}},[s("div",{staticClass:"pro-title"},[t._v("添加优惠券")]),t._v(" "),s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"券名称"}},[s("el-input",{attrs:{placeholder:"请输入优惠券名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"券类型"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},t._l(t.typeArr,function(t,e){return s("el-option",{key:e,attrs:{label:t.name,value:t.type}})}))],1),t._v(" "),s("div",{staticClass:"line"}),t._v(" "),3!=t.form.type?s("el-form-item",{attrs:{label:"券值"}},[s("el-input",{attrs:{placeholder:"请输入券值"},model:{value:t.form.value,callback:function(e){t.$set(t.form,"value",e)},expression:"form.value"}}),t._v("\n                元\n            ")],1):s("el-form-item",{attrs:{label:"折扣"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.value,callback:function(e){t.$set(t.form,"value",e)},expression:"form.value"}},t._l(t.discountArr,function(t,e){return s("el-option",{key:e,attrs:{label:t.name,value:t.type}})}))],1),t._v(" "),s("el-form-item",{attrs:{label:"券模板"}},[s("el-select",{attrs:{placeholder:"请选择券模板"},model:{value:t.form.discountCouponTemplateId,callback:function(e){t.$set(t.form,"discountCouponTemplateId",e)},expression:"form.discountCouponTemplateId"}},t._l(t.tempArr,function(t,e){return s("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),2!=t.form.type&&4!=t.form.type?s("el-form-item",{staticStyle:{"margin-top":"30px"},attrs:{label:"使用限制"}},[t._v("\n                满\n                "),s("el-input",{attrs:{placeholder:"请输入金额"},model:{value:t.useConditions,callback:function(e){t.useConditions=e},expression:"useConditions"}}),t._v("\n                元可用\n            ")],1):t._e(),t._v(" "),s("el-form-item",{attrs:{label:"可用周期"}},[s("div",{staticStyle:{display:"inline-block",margin:"0 50px 10px 0"}},[t._v("领到券当日开始\n                    "),s("el-input",{staticClass:"sml-inp",attrs:{disabled:t.isDay},model:{value:t.day,callback:function(e){t.day=e},expression:"day"}}),t._v("\n                    天内有效\n                ")],1),t._v(" "),s("el-checkbox",{model:{value:t.isDay,callback:function(e){t.isDay=e},expression:"isDay"}},[t._v("设置为礼包周期优惠券")]),t._v(" "),s("div",[t._v("领到券当天后\n                    "),s("el-input",{staticClass:"sml-inp",attrs:{disabled:!t.isDay},model:{value:t.monthOrWeek,callback:function(e){t.monthOrWeek=e},expression:"monthOrWeek"}}),t._v(" "),s("el-select",{staticClass:"sml-inp",attrs:{disabled:!t.isDay},on:{change:t.changeType},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[s("el-option",{attrs:{label:"月",value:"3"}},[t._v("月")]),t._v(" "),s("el-option",{attrs:{label:"周",value:"2"}},[t._v("周")])],1),t._v("\n                    开始生效，次"+t._s(t.tipInf)+"当天生效\n                    "),s("div",[t._v("例:领券日期为当月5日，如1月后生效，则次月5日生效，再次月的5日凌晨失效")])],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"到期提醒"}},[s("el-checkbox",{model:{value:t.expirationReminder,callback:function(e){t.expirationReminder=e},expression:"expirationReminder"}},[t._v("到期前4天提醒一次")])],1),t._v(" "),s("el-form-item",{attrs:{label:"可用品类"}},[4!=t.form.type?s("v-multichoose",{on:{getProductIds:t.getProductIds}}):s("v-onlychoose",{on:{getProductIds:t.getProductIds}})],1),t._v(" "),s("el-form-item",{staticClass:"role-choose",attrs:{label:"可使用用户层级"}},[s("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("\n                    全部用户\n                ")]),t._v(" "),s("div",{staticStyle:{margin:"15px 0"}}),t._v(" "),s("el-checkbox-group",{on:{change:t.handleCheckedUsersChange},model:{value:t.checkedUsers,callback:function(e){t.checkedUsers=e},expression:"checkedUsers"}},t._l(t.users,function(e,i){return s("el-checkbox",{key:i,attrs:{label:e}},[t._v(t._s(e.name)+"\n                    ")])}))],1),t._v(" "),s("el-form-item",{attrs:{label:"发放数量"}},[s("el-input",{staticClass:"mid-inp",attrs:{disabled:t.totalNumber},model:{value:t.form.totalNumber,callback:function(e){t.$set(t.form,"totalNumber",e)},expression:"form.totalNumber"}}),t._v("\n                张\n                "),s("span",[s("el-checkbox",{staticStyle:{"margin-left":"10px"},model:{value:t.totalNumber,callback:function(e){t.totalNumber=e},expression:"totalNumber"}},[t._v("不限制")])],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"每人限额"}},[s("el-input",{staticClass:"mid-inp",attrs:{disabled:t.maxDealerGetNumber},model:{value:t.form.maxDealerGetNumber,callback:function(e){t.$set(t.form,"maxDealerGetNumber",e)},expression:"form.maxDealerGetNumber"}}),t._v("\n                张\n                "),s("span",[s("el-checkbox",{staticStyle:{"margin-left":"10px"},model:{value:t.maxDealerGetNumber,callback:function(e){t.maxDealerGetNumber=e},expression:"maxDealerGetNumber"}},[t._v("不限制")])],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"优惠券说明"}},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入说明"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),t._v(" "),s("el-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.submitForm}},[t._v("提交")]),t._v(" "),s("el-button",{on:{click:t.cancel}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]};var u=s("VU/8")(l,h,!1,function(t){s("ZZCZ")},null,null);e.default=u.exports},"s/ju":function(t,e,s){"use strict";var i=s("mvHQ"),a=s.n(i),r=s("UU1J"),d=s("GVVA"),o={components:{icon:r.a},props:["getProducts"],data:function(){return{first:[],second:[],third:[],productList:[],checkAll:!1,name:"",isIndeterminate:!1,firstChecked:[],secondChecked:[],thirdChecked:[],productChecked:[],firstCategoryId:"",secCategoryId:"",thirdCategoryId:"",firstCategoryIds:[],secCategoryIds:[],thirdCategoryIds:[],firstCategoryName:"",secCategoryName:"",thirdCategoryName:"",firstCategoryNames:[],thirdCategoryNames:[],products:[],firstIndex:"",secondIndex:"",thirdIndex:"",loading:!1,firstClassifyTags:[],secondClassifyTags:[],thirdClassifyTags:[],productTags:[],firstTagIds:[],secondTagIds:[],thirddTagIds:[],productTagIds:[],checkedList:[]}},watch:{getProducts:function(t){if(this.resetValue(),t.firstCategoryIds)for(var e in-1==t.firstCategoryIds.indexOf(",")?(this.firstTagIds=this.firstCategoryIds=[Number(t.firstCategoryIds)],this.firstCategoryNames=[t.firstCategoryNames]):(this.firstTagIds=this.firstCategoryIds=this.toNumber(t.firstCategoryIds.split(",")),this.firstCategoryNames=t.firstCategoryNames.split(",")),this.firstTagIds)this.firstClassifyTags.push({id:this.firstTagIds[e],name:this.firstCategoryNames[e]});else this.firstCategoryNames=this.firstTagIds=this.firstCategoryIds=[];if(t.secCategoryIds)for(var s in-1==t.secCategoryIds.indexOf(",")?(this.secondTagIds=this.secCategoryIds=[Number(t.secCategoryIds)],this.secCategoryNames=[t.secCategoryNames]):(this.secondTagIds=this.secCategoryIds=this.toNumber(t.secCategoryIds.split(",")),this.secCategoryNames=t.secCategoryNames.split(",")),this.secondTagIds)this.secondClassifyTags.push({id:this.secondTagIds[s],name:this.secCategoryNames[s]});else this.secCategoryNames=this.secondTagIds=this.secCategoryIds=[];if(t.thirdCategoryIds)for(var i in-1==t.thirdCategoryIds.indexOf(",")?(this.thirdTagIds=this.thirdCategoryIds=[Number(t.thirdCategoryIds)],this.thirdCategoryNames=[t.thirdCategoryNames]):(this.thirdTagIds=this.thirdCategoryIds=this.toNumber(t.thirdCategoryIds.split(",")),this.thirdCategoryNames=t.thirdCategoryNames.split(",")),this.thirdTagIds)this.thirdClassifyTags.push({id:this.thirdTagIds[i],name:this.thirdCategoryNames[i]});else this.thirdCategoryNames=this.thirdTagIds=this.thirdCategoryIds=[];if(t.products)for(var a in-1==t.products.indexOf(",")?this.productTagIds=this.products=[Number(t.products)]:this.productTagIds=this.products=this.toNumber(t.products.split(",")),this.productTagIds)this.productTags.push({id:this.productTagIds[a]});else this.productTags=this.productTagIds=this.products=[];this.getFirst()}},created:function(){this.resetValue(),this.getFirst()},methods:{resetValue:function(){this.firstCategoryIds=[],this.secCategoryNames=[],this.thirdCategoryNames=[],this.products=[],this.firstClassifyTags=[],this.secondClassifyTags=[],this.thirdClassifyTags=[],this.productTags=[],this.firstTagIds=[],this.secondTagIds=[],this.thirdTagIds=[],this.productTagIds=[],this.checkedList=[],this.checkAll=!1},getFirst:function(){var t=this;t.loading=!0;d.a.queryProductCategoryList({page:1,pageSize:1e4,level:1,fatherId:0}).then(function(e){t.first=e.data,e.data.forEach(function(e,s){-1!=t.firstTagIds.indexOf(e.id)?t.firstChecked[s]=!0:t.firstChecked[s]=!1}),t.loading=!1,t.isFirstAllCheck()}).catch(function(e){console.log(e),t.loading=!1})},handleCheckAllChange:function(){for(var t in this.firstChecked)this.firstChecked[t]=this.checkAll;this.isFirstAllCheck();var e=this;this.checkAll?e.first.forEach(function(t,s){e.addTags(1,t),e.firstCategoryIds.push(t.id)}):(e.first.forEach(function(t,s){e.deleteTags(1,t,"false")}),e.firstCategoryIds=[]),this.transValue()},isFirstAllCheck:function(){var t=0;for(var e in this.firstChecked)this.firstChecked[e]&&t++;this.isIndeterminate=t>0&&this.firstChecked.length>t,0==t&&(this.checkAll=!1),t==this.firstChecked.length?this.checkAll=!0:this.checkAll=!1,this.transValue()},isFirstSecondCheck:function(t){var e=this,s=1==t?this.secondChecked:this.productChecked,i=1==t?this.firstChecked:this.secondChecked,a=1==t?this.firstIndex:this.secondIndex,r=1==t?this.first:this.second,d=1==t?this.second:this.productList,o=0;for(var n in s)s[n]&&o++;i[a]=s.length==o,i[a]?(d.forEach(function(s,i){e.deleteTags(parseInt(t+1),s,"false")}),this.addTags(t,r[a])):(this.deleteTags(t,r[a],"false"),d.forEach(function(i,a){s[a]&&e.addTags(parseInt(t+1),i)})),1==t&&this.isFirstAllCheck(),2==t&&this.isFirstSecondCheck(1),this.transValue()},getSecond:function(t,e){var s=this;s.firstCategoryName=t.name,s.firstChecked[e]?(s.addTags(1,t),s.changePreValues(t,"add",1),s.second.forEach(function(t,e){s.deleteTags(2,t,"false")}),s.deleteProductTags(t)):(s.deleteTags(1,t,"false"),s.changePreValues(t,"delete",1));var i=[];if(s.checkedList.forEach(function(t,e){i.push(t.id)}),-1==i.indexOf(t.id)&&s.checkedList.push({id:t.id,productIds:[]}),s.isFirstAllCheck(),s.productList=[],s.secCategoryId="",s.firstCategoryId!=t.id){s.second=[],s.secondChecked=[],s.firstIndex=e,s.firstCategoryId=t.id;var a={fatherId:t.id,page:1,pageSize:1e4,level:2};s.loading=!1,d.a.queryProductCategoryList(a).then(function(t){s.second=t.data,t.data.forEach(function(t,i){-1!=s.secondTagIds.indexOf(t.id)||s.firstChecked[e]?s.secondChecked[i]=!0:s.secondChecked[i]=!1,s.loading=!1})}).catch(function(t){console.log(t),s.loading=!1})}else s.changeNextValues(1,e)},getThird:function(t,e){var s=this;s.secondCategoryName=t.name,s.firstChecked[e]?(s.addTags(1,t),s.changePreValues(t,"add",1),s.second.forEach(function(t,e){s.deleteTags(2,t,"false")}),s.deleteProductTags(t)):(s.deleteTags(1,t,"false"),s.changePreValues(t,"delete",1));var i=[];if(s.checkedList.forEach(function(t,e){i.push(t.id)}),-1==i.indexOf(t.id)&&s.checkedList.push({id:t.id,productIds:[]}),s.isFirstAllCheck(),s.productList=[],s.secCategoryId="",s.firstCategoryId!=t.id){s.third=[],s.thirdChecked=[],s.secondIndex=e,s.secondCategoryId=t.id;var a={fatherId:t.id,page:1,pageSize:1e4,level:3};s.loading=!1,d.a.queryProductCategoryList(a).then(function(t){s.third=t.data,t.data.forEach(function(t,i){-1!=s.thirdTagIds.indexOf(t.id)||s.secondChecked[e]?s.thirdChecked[i]=!0:s.thirdChecked[i]=!1,s.loading=!1})}).catch(function(t){console.log(t),s.loading=!1})}else s.changeNextValues(1,e)},getProductList:function(t,e){var s=this;if(s.thirdChecked[e]?(s.thirdCategoryName=t.name,s.addTags(3,t),s.changePreValues(t,"add",3),s.productList.forEach(function(t,e){s.deleteTags(4,t,"false")})):(s.deleteTags(3,t,"false"),s.changePreValues(t,"delete",3)),s.isFirstSecondCheck(1),s.thirdCategoryId!=t.id){s.productList=[],s.productChecked=[],s.products=[],s.thirdIndex=e,s.thirdCategoryId=t.id;var i={page:1,pageSize:1e4,firstCategoryId:s.firstCategoryId,secCategoryId:s.secCategoryId,thirdCategoryId:s.thirdCategoryId};s.loading=!1,d.a.queryProductPageList(i).then(function(t){s.productList=t.data,t.data.forEach(function(t,i){-1!=s.productTagIds.indexOf(t.id)||s.thirdChecked[e]?s.productChecked[i]=!0:s.productChecked[i]=!1}),s.loading=!1}).catch(function(t){console.log(t),s.loading=!1})}else s.changeNextValues(3,e)},chooseProduct:function(t,e){if(this.productChecked[e])this.addTags(4,t),-1==this.products.indexOf(t.id)&&this.products.push(t.id);else if(this.deleteTags(4,t,"false"),-1!=this.products.indexOf(t.id))for(var s in this.products)this.products[s]==t.id&&this.products.splice(s,1);var i=this;i.checkedList.forEach(function(s,a){if(s.id==i.firstCategoryId)if(i.productChecked[e])s.productIds.push(t.id);else for(var r in s.productIds)t.id==s.productIds[r]&&s.productIds.splice(r,1)}),this.isFirstSecondCheck(2),this.transValue()},deleteProductTags:function(t){var e=this;e.checkedList.forEach(function(s,i){if(s.id==t.id)for(var a in e.productTagIds){var r=e.productTagIds[a];-1!=s.productIds.indexOf(r)&&(e.productTagIds.splice(a,1),e.productTags.splice(a,1),e.productTagIds.length&&e.deleteProductTags(t))}})},changePreValues:function(t,e,s){var i=1===s?this.firstCategoryIds:2===s?this.secCategoryIds:this.thirdCategoryIds,a=1===s?this.firstCategoryNames:2===s?this.secCategoryNames:this.thirdCategoryNames;if("add"===e)-1===i.indexOf(t.id)&&(i.push(t.id),a.push(t.name));else for(var r in i)t.id==i[r]&&(i.splice(r,1),a.splice(r,1));this.transValue()},changeNextValues:function(t,e){var s=1===t?this.firstChecked:2===t?this.secondChecked:this.thirdChecked,i=1===t?this.secondChecked:2===t?this.thirdChecked:this.productChecked,a=this.productChecked;for(var r in i)i[r]=s[e];if(1===t)for(var d in a)a[d]=!1;this.transValue()},addTags:function(t,e){var s=1===t?this.firstClassifyTags:2===t?this.secondClassifyTags:3===t?this.thirdClassifyTags:this.productTags,i=1===t?this.firstTagIds:2===t?this.secondTagIds:3===t?this.thirdTagIds:this.productTagIds,a=2===t?this.firstCategoryId:3===t?this.secCategoryId:this.thirdCategoryId,r=2===t?this.secondTagIds:3===t?this.thirdTagIds:this.productTagIds;-1==i.indexOf(e.id)&&(1!=t?-1==r.indexOf(a)&&(s.push(e),i.push(e.id)):(s.push(e),i.push(e.id)))},deleteTags:function(t,e,s){var i=[],a=1===t?this.firstTagIds:2===t?this.secondTagIds:3===t?this.thirdTagIds:this.productTagIds,r=1===t?this.firstClassifyTags:2===t?this.secondClassifyTags:3===t?this.thirdClassifyTags:this.productTags,d=1===t?this.first:2===t?this.second:3===t?this.third:this.productList,o=1===t?this.firstChecked:2===t?this.secondChecked:3===t?this.thirdChecked:this.productChecked,n=1===t?this.firstCategoryIds:2===t?this.secondTagIds:3===t?this.thirdTagIds:this.productIds;for(var c in a)e.id==a[c]&&(r.splice(c,1),a.splice(c,1));if("true"===s){for(var l in d.forEach(function(t,e){i.push(t.id)}),i)e.id==i[l]&&(o[l]=!1,this.$set(o,l,o[l]),4!==t&&(this.changeNextValues(t,l),1===t&&this.isFirstAllCheck()));for(var h in n)n[h]==e.id&&n.splice(h,1);this.transValue()}},transValue:function(){var t={firstCategoryIds:this.firstCategoryIds,secCategoryIds:this.secCategoryIds,products:this.products,checkAll:this.checkAll};this.$emit("getProductIds",a()(t))},toNumber:function(t){var e=[];for(var s in t)e.push(Number(t[s]));return e}}},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"choose-box"},[s("div",{staticStyle:{"margin-top":"10px"}},[s("div",{staticClass:"check-area"},[s("div",{staticClass:"title"},[t._v("一级类目")]),t._v(" "),s("div",{staticClass:"data-area"},[s("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[s("span",[t._v("全品类")])]),t._v(" "),t._l(t.first,function(e,i){return s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],key:i},[s("el-checkbox",{attrs:{value:e.id},on:{change:function(s){t.getSecond(e,i)}},model:{value:t.firstChecked[i],callback:function(e){t.$set(t.firstChecked,i,e)},expression:"firstChecked[index]"}}),t._v(" "),s("span",{staticClass:"expand-btn",on:{click:function(s){t.getSecond(e,i)}}},[t._v(t._s(e.name))])],1)})],2)]),t._v(" "),s("div",{staticClass:"check-area"},[s("div",{staticClass:"title"},[t._v("二级类目")]),t._v(" "),t.second.length>0?s("div",{staticClass:"data-area"},t._l(t.second,function(e,i){return s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],key:i},[s("el-checkbox",{attrs:{value:e.id},on:{change:function(s){t.getThird(e,i)}},model:{value:t.secondChecked[i],callback:function(e){t.$set(t.secondChecked,i,e)},expression:"secondChecked[index]"}}),t._v(" "),s("span",{staticClass:"expand-btn",on:{click:function(s){t.getThird(e,i)}}},[t._v(t._s(e.name))])],1)})):s("div",{staticClass:"nodata"},[t._v("\n                暂无数据~\n            ")])]),t._v(" "),s("div",{staticClass:"check-area"},[s("div",{staticClass:"title"},[t._v("三级类目")]),t._v(" "),t.third.length>0?s("div",{staticClass:"data-area"},t._l(t.third,function(e,i){return s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],key:i},[s("el-checkbox",{attrs:{value:e.id},on:{change:function(s){t.getProductList(e,i)}},model:{value:t.thirdChecked[i],callback:function(e){t.$set(t.thirdChecked,i,e)},expression:"thirdChecked[index]"}}),t._v(" "),s("span",{staticClass:"expand-btn",on:{click:function(s){t.getProductList(e,i)}}},[t._v(t._s(e.name))])],1)})):s("div",{staticClass:"nodata"},[t._v("\n                暂无数据~\n            ")])]),t._v(" "),s("div",{staticClass:"check-area"},[s("div",{staticClass:"title"},[t._v("产品\n                "),s("el-input",{attrs:{placeholder:"请输入产品名称或者ID进行查找","suffix-icon":"el-icon-search"}})],1),t._v(" "),t.productList.length>0?s("div",{staticClass:"data-area"},t._l(t.productList,function(e,i){return s("div",{key:i},[s("el-checkbox",{attrs:{label:e.name,value:e.id},on:{change:function(s){t.chooseProduct(e,i)}},model:{value:t.productChecked[i],callback:function(e){t.$set(t.productChecked,i,e)},expression:"productChecked[index]"}},[t._v("\n                        产品ID:"+t._s(e.id)+" "),s("span",{staticClass:"product-name"},[t._v(t._s(e.name))])])],1)})):s("div",{staticClass:"nodata"},[t._v("\n                暂无数据~\n            ")])]),t._v(" "),s("div",{staticClass:"clearfix"}),t._v(" "),s("div",{staticStyle:{"margin-top":"10px"}},[t.firstClassifyTags.length?s("div",[t._v("\n                一级类目：\n                "),t._l(t.firstClassifyTags,function(e,i){return s("el-tag",{key:i,attrs:{closable:""},on:{close:function(s){t.deleteTags(1,e,"true")}}},[t._v("\n                    "+t._s(e.name)+"\n                ")])})],2):t._e(),t._v(" "),t.secondClassifyTags.length?s("div",[t._v("\n                二级类目：\n                "),t._l(t.secondClassifyTags,function(e,i){return s("el-tag",{key:i,attrs:{closable:""},on:{close:function(s){t.deleteTags(2,e,"true")}}},[t._v("\n                    "+t._s(e.name)+"\n                ")])})],2):t._e(),t._v(" "),t.thirdClassifyTags.length?s("div",[t._v("\n                三级类目：\n                "),t._l(t.thirdClassifyTags,function(e,i){return s("el-tag",{key:i,attrs:{closable:""},on:{close:function(s){t.deleteTags(3,e,"true")}}},[t._v("\n                    "+t._s(e.name)+"\n                ")])})],2):t._e(),t._v(" "),t.productTags.length?s("div",[t._v("\n                产品ID：\n                "),t._l(t.productTags,function(e,i){return s("el-tag",{key:i,attrs:{closable:""},on:{close:function(s){t.deleteTags(4,e,"true")}}},[t._v("\n                    "+t._s(e.id)+"\n                ")])})],2):t._e()])])])},staticRenderFns:[]};var c=s("VU/8")(o,n,!1,function(t){s("MrZ7")},"data-v-fa3fbd14",null);e.a=c.exports}});