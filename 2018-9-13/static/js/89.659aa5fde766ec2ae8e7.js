webpackJsonp([89],{haIa:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Xxa5"),r=a.n(n),s=a("exGp"),i=a.n(s),o=a("FMx0"),l=a("P9l9"),c=(a("19nM"),a("GVVA")),d={components:{breadcrumb:o.a},data:function(){return{nav:["权限管理","修改管理员信息"],btnLoading:!1,checkAllUser:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],checkedUser:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],getUserPriList:[],uploadImg:"",userManList:[],department:[],jobList:[],tmpJobId:"",id:"",bodyLoading:!1,form:{name:"",telephone:"",deptmentId:"",jobId:"",immediateSuperior:"",face:""},rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],telephone:[{required:!0,message:"请输入手机号",trigger:"blur"}],deptmentId:[{required:!0,message:"请输入所属部门",trigger:"blur"}],jobId:[{required:!0,message:"请输入所在岗位",trigger:"blur"}],immediateSuperior:[{required:!0,message:"请输入直接上级ID",trigger:"blur"}]}}},mounted:function(){},activated:function(){this.getCreatedMsg()},methods:{submitForm:function(e){var t=this,a={},n=[];/^1(3|4|5|6|7|8)\d{9}$/.test(Number(this.form.telephone))?(this.checkedUser.forEach(function(e,t){e.forEach(function(e){n.push(e)})}),(a=this.form).role=n.join(","),a.id=this.id,this.btnLoading=!0,this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;c.a.updateAdminUser(a).then(function(e){t.btnLoading=!1,t.$message.success(e.msg),t.$router.push("/manageList")}).catch(function(e){console.log(e),t.btnLoading=!1})})):this.$message.warning("请输入正确的手机号！")},resetForm:function(e){this.$refs[e].resetFields()},assemblyData:function(){var e=this;this.checkedUser=[];for(var t=0;t<this.userManList.length+1;t++)this.checkedUser.push([]);this.userManList.forEach(function(t,a){var n=0;t.value.forEach(function(t,r){t.value.forEach(function(t,r){n++,-1!=e.getUserPriList.indexOf(t.id)&&e.checkedUser[a].push(t.id)})}),n==e.checkedUser[a].length&&(e.checkAllUser[a]=!0)})},uploadAvatar:function(e){this.form.face=e.data.imageUrl},handleCheckAllChangeUser:function(e,t){var a=[];this.userManList[t].value.forEach(function(e){e.value.forEach(function(e){a.push(e.id)})}),this.checkedUser[t]=e?a:[]},handleCheckedUserChange:function(e,t){var a=[],n=e.length;this.userManList[t].value.forEach(function(e){e.value.forEach(function(e){a.push(e.value)})}),this.checkAllUser[t]=n==a.length,this.$set(this.checkAllUser,t,this.checkAllUser[t])},getRoleList:function(){var e=this;c.a.getRoleList({}).then(function(t){e.userManList=t.data}).catch(function(e){console.log(e)})},getDepartmentList:function(){var e=this;this.department=[],c.a.queryDepartmentList({}).then(function(t){0!==t.data.length&&t.data.forEach(function(t,a){e.department.push({label:t.name,value:t.id})})}).catch(function(e){console.log(e)})},getJobList:function(e){var t=this;this.jobList=[],this.form.jobId="",c.a.queryJobList({id:e}).then(function(e){0!==e.data.length&&e.data.forEach(function(e,a){t.jobList.push({label:e.name,value:e.id})})}).catch(function(e){console.log(e)})},getCreatedMsg:function(){var e=this;return i()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.bodyLoading=!0,e,e.uploadImg=l.addImg,t.next=5,e.getDepartmentList();case 5:return t.next=7,e.getRoleList();case 7:return e.checkAllUser=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],e.id=e.$route.params.id||sessionStorage.getItem("editManger"),t.next=11,c.a.findAdminUserbyId({id:e.id}).then(function(t){e.getUserPriList=[],e.form.name=t.data.name,e.form.telephone=t.data.telephone,e.form.deptmentId=t.data.deptmentId,e.getJobList(e.form.deptmentId,1),e.bodyLoading=!1,e.form.jobId=t.data.jobId,e.form.immediateSuperior=t.data.immediateSuperior,e.form.face=t.data.face,t.data.adminUserPrivilegeList.forEach(function(t,a){e.getUserPriList.push(t.privilegeId)})}).catch(function(t){console.log(t),e.bodyLoading=!1});case 11:e.assemblyData();case 12:case"end":return t.stop()}},t,e)}))()}}},u={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"add-manger"},[n("breadcrumb",{attrs:{nav:e.nav}}),e._v(" "),n("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.bodyLoading,expression:"bodyLoading"}]},[n("div",{staticClass:"add-box"},[n("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[n("span",{staticClass:"add-box-title"},[e._v("基础信息")]),e._v(" "),n("el-form-item",{attrs:{prop:"name",label:"姓名"}},[n("el-input",{staticClass:"add-mange-inp",model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),n("el-form-item",{attrs:{prop:"telephone",label:"手机号"}},[n("el-input",{staticClass:"add-mange-inp",model:{value:e.form.telephone,callback:function(t){e.$set(e.form,"telephone",t)},expression:"form.telephone"}})],1),e._v(" "),n("div",{staticClass:"avatar"},[e.form.face?n("img",{attrs:{src:e.form.face}}):n("img",{attrs:{src:a("odpv"),alt:""}}),e._v(" "),n("el-upload",{attrs:{action:e.uploadImg,"show-file-list":!1,"on-success":e.uploadAvatar}},[n("el-button",{attrs:{type:"primary"}},[e._v("编辑头像")])],1),e._v(" "),n("div",{staticClass:"tip"},[e._v("请上传jpg，png格式")])],1),e._v(" "),n("div",{staticClass:"clearfix"}),e._v(" "),n("hr",{staticClass:"add-box-sep",attrs:{width:"90%",size:"1",color:"#ccc"}}),e._v(" "),n("span",{staticClass:"add-box-title"},[e._v("部门信息")]),e._v(" "),n("el-form-item",{attrs:{prop:"deptmentId",label:"所属部门"}},[n("el-select",{attrs:{placeholder:"请选择"},on:{change:e.getJobList},model:{value:e.form.deptmentId,callback:function(t){e.$set(e.form,"deptmentId",t)},expression:"form.deptmentId"}},e._l(e.department,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),n("el-form-item",{attrs:{prop:"jobId",label:"所在岗位"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.jobId,callback:function(t){e.$set(e.form,"jobId",t)},expression:"form.jobId"}},e._l(e.jobList,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),n("el-form-item",{attrs:{prop:"immediateSuperior",label:"直接上级"}},[n("el-input",{staticClass:"add-mange-inp",model:{value:e.form.immediateSuperior,callback:function(t){e.$set(e.form,"immediateSuperior",t)},expression:"form.immediateSuperior"}})],1),e._v(" "),n("hr",{staticClass:"add-box-sep",attrs:{width:"90%",size:"1",color:"#ccc"}}),e._v(" "),n("span",{staticClass:"add-box-title"},[e._v("权限信息")]),e._v(" "),e._l(e.userManList,function(t,a){return n("el-collapse",{key:a,attrs:{accordion:""}},[n("el-collapse-item",[n("template",{slot:"title"},[n("el-checkbox",{staticClass:"collapse-tit",on:{change:function(t){e.handleCheckAllChangeUser(e.checkAllUser[a],a)}},model:{value:e.checkAllUser[a],callback:function(t){e.$set(e.checkAllUser,a,t)},expression:"checkAllUser[k]"}},[e._v(e._s(t.title))])],1),e._v(" "),n("el-checkbox-group",{on:{change:function(t){e.handleCheckedUserChange(e.checkedUser[a],a)}},model:{value:e.checkedUser[a],callback:function(t){e.$set(e.checkedUser,a,t)},expression:"checkedUser[k]"}},e._l(t.value,function(t,a){return n("div",{key:a},[n("div",{staticClass:"collapse-title"},[e._v(e._s(t.title))]),e._v(" "),n("div",{staticStyle:{overflow:"hidden","margin-bottom":"10px"}},[n("div",{staticClass:"collapse-item"},e._l(t.value,function(t,a){return n("el-checkbox",{key:a,attrs:{label:t.id}},[e._v(e._s(t.title))])}))])])}))],2)],1)}),e._v(" "),n("el-form-item",[n("el-button",{staticStyle:{"margin-left":"35%"},attrs:{loading:e.btnLoading,type:"primary"},on:{click:function(t){e.submitForm("form")}}},[e._v("提交")]),e._v(" "),n("el-button",{on:{click:function(t){e.resetForm("form")}}},[e._v("重置")])],1)],2)],1)])],1)},staticRenderFns:[]};var m=a("VU/8")(d,u,!1,function(e){a("mybD")},null,null);t.default=m.exports},mybD:function(e,t){}});