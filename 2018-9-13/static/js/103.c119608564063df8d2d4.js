webpackJsonp([103],{RGsG:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("mvHQ"),c=s.n(a),i=s("FMx0"),o=s("5fic"),d=s("V3Ru"),r=(s("0xDb"),s("UU1J")),n={components:{vBreadcrumb:i.a,icon:r.a},data:function(){return{nav:["运营管理","营销工具管理","优惠套餐","产品管理"],packageCode:"",id:"",keyWords:"",keyWordsID:"",showResult:!1,tableData:[],checkList:[],selectedPro:[],productSpecList:[],productIds:[],noResult:!1,name:"",prodCode:"",productNum:"",packageLists:[],tempProductLists:[],tempSpecIds:[],btnLoading:!1}},activated:function(){this.packageCode=this.$route.query.packageCode,this.id=this.$route.query.id,this.tableData=[],this.productLists=[],this.keyWords="",this.showResult=!1,this.getPackageProInfo()},methods:{getPackageProInfo:function(){var t=this;this.$axios.post(o.w,{packageCode:this.packageCode}).then(function(e){t.packageLists=[],e.data.data.forEach(function(e,s){var a={productLists:[],id:e.productId},c=e.specValues.split(","),i=e.productPriceId.split(",");for(var o in c){var d={packageCodeProductId:e.id,productPriceId:i[o],specValues:c[o],productName:e.productName,spec:c[o],productCode:e.productCode,productId:e.id,id:i[o]};a.productLists.push(d)}t.packageLists.push(a)})})},submitForm:function(){var t=this;if(this.packageLists.length){var e=[];this.packageLists.forEach(function(t,s){var a={};a.productId=t.id,a.num=1,a.specStr=[],t.productLists.forEach(function(t,e){var s={packageCodeProductId:t.productId,productPriceId:t.id,specValues:t.spec};a.specStr.push(s)}),e.push(a)});var s={};s.id=this.id,s.packageCode=this.packageCode,s.jsonStr=c()(e),s.url=d.addPackageProduct,this.btnLoading=!0,this.$axios.post(o.d,s).then(function(e){t.$message.success(e.data.msg),t.$router.push("/packageList"),t.btnLoading=!1}).catch(function(e){t.btnLoading=!1})}else this.$message.warning("请选择产品规格！")},querySearchAsync:function(t,e){""!=t&&(this.checkList=[],this.$axios.post(o.z,{condition:t,activityType:3}).then(function(t){var s=[];t.data.data.forEach(function(t,e){var a={};a.value=t.name+" 产品ID："+t.prodCode,a.id=t.id,a.name=t.name,a.prodCode=t.prodCode,a.productNum=t.productNum,s.push(a)}),e(s)}))},handleSelect:function(t){t.id!=this.keyWordsID&&(this.tempSpecIds=[],this.tempProductLists=[]),this.keyWordsID=t.id,this.name=t.name,this.prodCode=t.prodCode,this.productNum=t.productNum},getSpecList:function(){var t=this;""!=t.keyWordsID?0==t.productNum?t.noResult=!0:(t.noResult=!1,t.$axios.post(o.A,{productId:t.keyWordsID}).then(function(e){t.showResult=!0,t.tableData=[],e.data.data.forEach(function(e,s){e.checked=!1,t.tableData.push(e)})})):t.$message.success("暂无数据")},selectPro:function(t){if(1==t.checked)-1==this.tempSpecIds.indexOf(t.id)&&(this.tempSpecIds.push(t.id),this.tempProductLists.push(t));else for(var e in this.tempSpecIds)this.tempSpecIds[e]==t.id&&(this.tempSpecIds.splice(e,1),this.tempProductLists.splice(e,1))},setPackage:function(){this.tempSpecIds.length?(this.packageLists.push({productLists:this.tempProductLists,id:this.keyWordsID}),this.tempSpecIds=[],this.tempProductLists=[],this.getSpecList()):this.$message.warning("请选择产品规格!")},delSelectedPro:function(t,e){this.packageLists[e].productLists.splice(t,1),this.packageLists[e].productLists.length||this.packageLists.splice(e,1)},backToList:function(){this.$router.push("/packageList")}}},p={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"package-product-mange"},[s("v-breadcrumb",{attrs:{nav:t.nav}}),t._v(" "),s("el-card",{attrs:{"body-style":{padding:"50px"}}},[s("el-autocomplete",{staticStyle:{width:"600px"},attrs:{"fetch-suggestions":t.querySearchAsync,placeholder:"请输入产品名称模糊搜索"},on:{select:t.handleSelect},model:{value:t.keyWords,callback:function(e){t.keyWords=e},expression:"keyWords"}}),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.getSpecList}},[t._v("搜索")]),t._v(" "),t.showResult?s("div",[t.noResult?s("div",{staticClass:"nodata"},[s("div",{staticClass:"product-inf"},[t._v(t._s(t.name)+" "+t._s(t.prodCode))]),t._v(" "),s("div",{staticClass:"color-red no-stock"},[t._v("该商品无库存")])]):s("div",[s("el-table",{staticStyle:{"margin-top":"10px"},attrs:{data:t.tableData,border:""}},[s("el-table-column",{attrs:{prop:"spec",label:"规格",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"操作",align:"center",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-checkbox",{attrs:{value:e.row.id,disabled:0==e.row.stock},on:{change:function(s){t.selectPro(e.row)}},model:{value:e.row.checked,callback:function(s){t.$set(e.row,"checked",s)},expression:"scope.row.checked"}},[t._v("选择产品"),0==e.row.stock?s("span",{staticClass:"color-red"},[t._v("(无库存)")]):t._e()])]}}])})],1)],1)]):s("div",{staticClass:"nodata"},[t._v("\n            请输入产品名称模糊搜索~\n        ")]),t._v(" "),s("div",{staticClass:"set-pro-num"},[s("span",{staticStyle:{"font-size":"14px"}},[t._v("产品数量*1")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.setPackage}},[t._v("确认")])],1),t._v(" "),0==t.packageLists.length?[s("table",{staticClass:"selected-product"},[s("tr",{staticStyle:{color:"#aaa"}},[s("td",[t._v("请选择产品")])])])]:t._l(t.packageLists,function(e,a){return s("table",{key:a,staticClass:"selected-product"},t._l(e.productLists,function(c,i){return s("tr",{key:i},[0==i?s("td",{staticStyle:{width:"50px"},attrs:{rowspan:e.productLists.length}},[t._v(t._s(a+1))]):t._e(),t._v(" "),s("td",[t._v(t._s((c.productName||"")+(c.spec||"")))]),t._v(" "),s("td",[t._v("产品ID："+t._s(c.productCode))]),t._v(" "),s("td",{staticStyle:{"min-width":"100px"}},[t._v("x1")]),t._v(" "),s("td",{staticStyle:{"min-width":"80px",cursor:"pointer",color:"#33b4ff"},on:{click:function(e){t.delSelectedPro(i,a)}}},[t._v("删除\n                    ")])])}))}),t._v(" "),s("div",{staticStyle:{"margin-top":"20px"}},[s("el-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.submitForm}},[t._v("提交")]),t._v(" "),s("el-button",{on:{click:t.backToList}},[t._v("取消")])],1)],2)],1)},staticRenderFns:[]};var u=s("VU/8")(n,p,!1,function(t){s("f53O")},"data-v-28af1e9e",null);e.default=u.exports},f53O:function(t,e){}});