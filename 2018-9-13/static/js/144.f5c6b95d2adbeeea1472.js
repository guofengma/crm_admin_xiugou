webpackJsonp([144],{R1cw:function(t,e){},SuFz:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("mvHQ"),a=s.n(i),c=s("FMx0"),n=s("X3nD"),o=s("4cBs"),r={components:{vBreadcrumb:c.a},data:function(){return{nav:["品牌产品管理","产品管理","发布产品"],imgUpload:"",rowId:"",deleteFirstItem:"",deleteItem:"",specificationArr:[],tableData:[]}},activated:function(){this.clickStatus="0",this.imgUpload=n.a,this.productId=JSON.parse(this.$route.query.releaseProductId||sessionStorage.getItem("productSpecifications"))[1],this.secondItemId=JSON.parse(this.$route.query.releaseProductId||sessionStorage.getItem("productSpecifications"))[0],this.specificationArr=[],this.tableData=[],this.getProductInfo()},methods:{submitForm:function(){var t=this,e={},s=[],i=!1;this.tableData.map(function(e,a){""==e.code&&(i=!0),s.push({id:e.priId,specIds:e.id.join(","),spec:e.spec,specImg:e.imgUrl,status:e.status,productId:t.productId,barCode:e.code})}),i?this.$message.warning("请输入条形码"):(e.specData=a()(s),e.productId=this.productId,e.url=o.e,this.$axios.post(n.c,e).then(function(e){t.$message.success(e.data.msg),t.$router.push({name:"productList"})}).catch(function(t){console.log(t)}))},getProductInfo:function(){var t=this,e={};e.secCategoryId=this.secondItemId,e.productId=this.productId,e.url=o.e,this.$axios.post(n.n,e).then(function(e){t.specificationArr=[],e.data.data.spec.forEach(function(e,s){t.specificationArr.push({type:e.spec,id:e.spec_id,speArr:e.spec_values.split(",")})}),e.data.data.specValue.forEach(function(e,s){t.tableData.push({priId:e.id,spec:e.spec,imgUrl:e.specImg,code:e.barCode,id:e.specIds.split(","),status:e.status})})}).catch(function(t){console.log(t)})},createList:function(){var t=this,e={},s=[];this.specificationArr.forEach(function(e,i){var a={};a.spec=e.type,a.specId=e.id||"",a.specValue=e.speArr,a.productId=t.productId,s.push(a)}),0!=s.length?(e.saleSpecValue=a()(s),e.secCategoryId=this.secondItemId,e.productId=this.productId,e.url=o.e,this.$axios.post(n.d,e).then(function(e){t.$message.success("生成成功!"),t.tableData=[],e.data.data.saleSpecValue.forEach(function(e,s){t.tableData.push({spec:e.specValue.join("-"),imgUrl:"",code:"",id:e.id,status:"1"})})}).catch(function(t){console.log(t)})):this.$message.warning("请输入产品规格")},addSpe:function(t){this.specificationArr[t].speArr.push("")},deleteSpe:function(t,e){this.specificationArr[t].speArr.splice(e,1)},deleteType:function(t){this.specificationArr.splice(t,1)},showFirstDelBtn:function(t){this.deleteFirstItem=t},showDeleteBtn:function(t){this.deleteItem=t},addType:function(){this.specificationArr.push({type:"",speArr:[]})},beforeUpload:function(t){this.rowId=t},uploadSuccess:function(t){200==t.code?this.tableData[this.rowId].imgUrl=t.data.imageUrl:this.$message.warning(t.data.msg)},deleteImg:function(t){this.tableData[t].imgUrl=""},operateProduct:function(t,e){t.status=e}}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"product-specification"},[s("v-breadcrumb",{attrs:{nav:t.nav}}),t._v(" "),s("el-card",{attrs:{"body-style":{padding:"20px 45px"}}},[s("div",{staticClass:"spe-title"},[t._v("产品规格")]),t._v(" "),s("div",{staticClass:"spe-wrap"},[t._l(t.specificationArr,function(e,i){return s("div",{key:i},[s("div",{staticClass:"small-spe-title"},[s("span",[t._v("类型：")]),t._v(" "),s("div",{staticClass:"delete-big-tit",on:{mouseover:function(e){t.showFirstDelBtn(i)},mouseout:function(e){t.deleteFirstItem=""}}},[i==t.deleteFirstItem?s("div",{staticClass:"del-big-btn",on:{click:function(e){t.deleteType(i)}}},[t._v("×")]):t._e(),t._v(" "),s("el-input",{staticStyle:{width:"70px"},model:{value:t.specificationArr[i].type,callback:function(e){t.$set(t.specificationArr[i],"type",e)},expression:"specificationArr[index].type"}})],1)]),t._v(" "),s("div",{staticClass:"small-spe-content"},[s("span",[t._v("规格值：")]),t._v(" "),t._l(e.speArr,function(a,c){return s("div",{key:c,staticClass:"des-wrap",on:{mouseover:function(e){t.showDeleteBtn(a)},mouseout:function(e){t.deleteItem=""}}},[a==t.deleteItem?s("div",{staticClass:"delete-btn",on:{click:function(e){t.deleteSpe(i,c)}}},[t._v("×")]):t._e(),t._v(" "),s("el-input",{staticClass:"des-inp",model:{value:e.speArr[c],callback:function(s){t.$set(e.speArr,c,s)},expression:"value.speArr[k]"}})],1)}),t._v(" "),s("span",{staticClass:"add-spe",on:{click:function(e){t.addSpe(i)}}},[t._v("添加规格")])],2)])}),t._v(" "),s("div",{staticClass:"small-spe-title"},[s("el-button",{on:{click:t.addType}},[t._v("添加类型")])],1)],2),t._v(" "),s("el-button",{staticStyle:{margin:"10px 0 50px 0"},attrs:{type:"primary"},on:{click:t.createList}},[t._v("生成列表")]),t._v(" "),s("p",{staticStyle:{margin:"0 0 18px 10px"}},[t._v("规格表")]),t._v(" "),s("el-table",{attrs:{data:t.tableData,border:""}},[s("el-table-column",{attrs:{prop:"spec",label:"规格",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"条形码",align:"center",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-input",{model:{value:e.row.code,callback:function(s){t.$set(e.row,"code",s)},expression:"scoped.row.code"}})]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"图片",align:"center",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[""!=e.row.imgUrl?[s("div",{staticClass:"product-img"},[s("img",{attrs:{src:e.row.imgUrl,alt:""}})]),t._v(" "),s("el-button",{attrs:{type:"danger"},on:{click:function(s){t.deleteImg(e.$index)}}},[t._v("删除")])]:[s("el-upload",{attrs:{action:t.imgUpload,"show-file-list":!1,"on-success":t.uploadSuccess}},[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(s){t.beforeUpload(e.$index)}}},[t._v("选择图片")])],1)]]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"操作",align:"center",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.status?s("el-button",{attrs:{type:"warning"},on:{click:function(s){t.operateProduct(e.row,"1")}}},[t._v("启用")]):s("el-button",{attrs:{type:"danger"},on:{click:function(s){t.operateProduct(e.row,"2")}}},[t._v("停用")])]}}])})],1),t._v(" "),s("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("确认提交")])],1)],1)},staticRenderFns:[]};var d=s("VU/8")(r,l,!1,function(t){s("R1cw")},null,null);e.default=d.exports}});