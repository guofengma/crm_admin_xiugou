webpackJsonp([148],{"8xmp":function(t,e){},Enyn:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("mvHQ"),i=a.n(r),l=a("FMx0"),s=a("DAYN"),o=a.n(s),n=a("yPE/"),c=a.n(n),d=a("UU1J"),u=a("X3nD"),m=a("4cBs"),p=a("0xDb"),f=a.n(p),g={components:{draggable:o.a,vBreadcrumb:l.a,icon:d.a},data:function(){return{nav:["品牌产品管理","产品管理","发布产品"],isUseUpload:!1,showSaleTime:!1,productId:"",uploadImg:"",imgArr:[],itemList:[],brandArr:[],freightTemplateArr:[],supplierArr:[],shipperArr:[{label:"平台发货",value:"1"},{label:"供应商发货",value:"2"}],categoryArr:[],aferServiceDays:[{label:"无售后服务",value:"0"},{label:"到货后7天",value:"7"},{label:"到货后15天",value:"15"},{label:"到货后30天",value:"30"},{label:"到货后6个月",value:"180"},{label:"到货后1年",value:"365"},{label:"到货后2年",value:"730"},{label:"到货后3年",value:"1095"}],itemProps:{value:"value",children:"children"},proCategoryArr:[],form:{name:"",firstCategoryId:"",secCategoryId:"",brandId:"",supplierId:"",sendfrom:"",weight:"",volume:"",freightTemplateId:"",aferServiceDays:"",content:"",tagId:"",originalImg:"",smallImg:""},productParam:[],editorOption:{placeholder:"请输入内容",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image"]]}},uploadData:{},uploadType:"",selectedTagArr:[],tagArr:[],tagName:""}},computed:{qnLocation:function(){return location.protocol,u.a}},activated:function(){this.uploadImg=u.a,this.imgArr=[],this.selectedTagArr=[],this.getFirstItem(),this.getFreightTemplate(),f.a.cleanFormData(this.form),this.productId=this.$route.query.releaseProductId||sessionStorage.getItem("releaseProduct"),this.getProductInfo()},mounted:function(){this.$refs.myQuillEditor.quill.getModule("toolbar").addHandler("image",this.imgHandler)},methods:{getProductInfo:function(){var t=this,e={};e.productId=this.productId,e.url=m.b,this.$axios.post(u.f,e).then(function(e){t.imgArr=[],e.data.data.originalList.forEach(function(a,r){t.imgArr.push({originUrl:a,smallUrl:e.data.data.smalllList[r]})}),t.categoryArr=[],t.categoryArr.push(e.data.data.product.first_category_id),t.categoryArr.push(e.data.data.product.sec_category_id),t.getProItemId(t.categoryArr,!0),t.form.brandId=e.data.data.product.brand_id,t.getSupplyList(),t.form.supplierId=e.data.data.product.supplier_id,t.form.sendfrom=e.data.data.product.sendfrom.toString(),t.form.name=e.data.data.product.name,t.form.weight=e.data.data.product.weight,t.form.volume=e.data.data.product.volume,t.form.freightTemplateId=e.data.data.product.freight_template_id,t.form.aferServiceDays=e.data.data.product.afer_service_days.toString(),t.form.content=e.data.data.product.content,t.selectedTagArr=[],e.data.data.tagProduct.forEach(function(e,a){t.selectedTagArr.push({label:e.tagName,value:e.tag_id})}),t.productParam=[],e.data.data.infoValue.forEach(function(e,a){t.productParam.push({id:e.parm_id,parm:e.parm,parm_value:e.parm_value})}),t.getAllTags()}).catch(function(t){console.log(t)})},beforeSubmit:function(){return 0==this.imgArr.length?(this.$message.warning("请添加产品图片"),!1):0==this.selectedTagArr.length?(this.$message.warning("请添加产品标签"),!1):parseInt(this.form.weight)>=0?parseInt(this.form.volume)>=0?0!=this.productParam.length||(this.$message.warning("请输入产品参数"),!1):(this.$message.warning("请输入正确的体积"),!1):(this.$message.warning("请输入正确的重量"),!1)},submitForm:function(){var t=this;if(this.beforeSubmit()){var e=[],a=[],r=[];this.selectedTagArr.forEach(function(t,a){e.push(t.value)}),this.form.tagId=e.join(","),this.imgArr.forEach(function(t,e){a.push(t.smallUrl),r.push(t.originUrl)}),this.form.smallImg=i()(a),this.form.originalImg=i()(r),this.form.type=2;var l={};(l=this.form).id=this.productId,l.url=m.b;var s=[];this.productParam.forEach(function(t,e){s.push({parmId:t.id,parmValue:t.parm_value})}),l.specStr=i()(s),this.$axios.post(u.s,l).then(function(e){t.$message.success(e.data.data),t.$router.push("/productList")}).catch(function(t){console.log(t)})}},beforeUploadArr:function(){this.$message.warning("上传中...")},getdata:function(t){},datadragEnd:function(t){},successUpload:function(t){if(200==t.code){if(this.imgArr.length>=5)return this.isUseUpload=!0,void this.$message.warning("最多只能上传五张图片");this.imgArr.push({originUrl:t.data.imageUrl,smallUrl:t.data.imageThumbUrl}),this.$message.success("上传成功")}else this.$message.warning(t.data.msg)},deleteImg:function(t){var e=-1;this.imgArr.forEach(function(a,r){a.originUrl==t.originUrl&&(e=r)}),-1!=e&&(this.imgArr.splice(e,1),this.imgArr.length<5&&(this.isUseUpload=!1))},defSaleTime:function(){this.form.aferServiceDays="",this.showSaleTime=!this.showSaleTime},onEditorChange:function(t){t.editor;var e=t.html;t.text;this.form.content=e},upScuccess:function(t,e,a){this.fullscreenLoading=!1;var r=this,i="";if("image"===this.uploadType&&(i=t.data.imageUrl,this.form.original_img=t.data.imageUrl,this.form.small_img=t.data.imageThumbUrl,console.log(t)),null!=i&&i.length>0){var l=i;r.addRange=r.$refs.myQuillEditor.quill.getSelection(),l=-1!==l.indexOf("http")?l:"http:"+l,r.$refs.myQuillEditor.quill.insertEmbed(null!==r.addRange?r.addRange.index:0,r.uploadType,l,c.a.sources.USER),this.$message.success("插入成功")}else this.$message.error(r.uploadType+"插入失败");this.$refs.upload.clearFiles()},imgHandler:function(t){(this.addRange=this.$refs.myQuillEditor.quill.getSelection(),t)&&document.getElementById("imgInput").click();this.uploadType="image"},handleClose:function(t,e){var a=this;this.selectedTagArr.splice(t,1),this.tagArr.forEach(function(t,r){e.label==t.label&&(a.tagArr[r].selected=!1)})},addTag:function(){var t=this;if(""!=this.tagName){var e=!1;if(this.tagArr.forEach(function(a,r){t.tagName==a.label&&(e=!0)}),e)this.$message.warning("标签已经添加，请不要重复添加!");else{var a={};a.name=this.tagName,a.url=m.b,a.type=2,this.$axios.post(u.e,a).then(function(e){t.$message.success("添加成功!"),t.tagName="",t.getAllTags()}).catch(function(t){console.log(t)})}}else this.$message.warning("请输入正确的标签")},insertTag:function(t){this.selectedTagArr.length>19?this.$message.warning("最多添加20个标签"):(t.selected=!0,this.selectedTagArr.push({label:t.label,value:t.value}))},getFirstItem:function(){var t=this;this.itemList=[],this.$axios.post(u.h,{fatherid:0,pageSize:1e6,url:m.b}).then(function(e){e.data.data.data.forEach(function(e,a){t.itemList.push({label:e.name,value:e.id,children:[]}),t.handleItemChange(e.id)})}).catch(function(t){console.log(t)})},handleItemChange:function(t){var e=this,a=0;this.itemList.forEach(function(e,r){e.value==t&&(a=r)});var r={};r.fatherid=t,r.url=m.b,r.pageSize=1e6,this.itemList[a].children=[],this.$axios.post(u.h,r).then(function(t){t.data.data.data.forEach(function(t,r){e.itemList[a].children.push({label:t.name,value:t.id})})}).catch(function(t){console.log(t)})},getProItemId:function(t,e){var a=this;this.form.brandId="";var r=this.form.secCategoryId=t[1];this.form.firstCategoryId=t[0],this.form.secCategoryId=t[1],this.brandArr=[],e||this.getProductParam(t[1]),this.$axios.post(u.k,{cId:r,pageSize:1e6,url:m.b}).then(function(t){t.data.data.forEach(function(t,e){a.brandArr.push({label:t.name,value:t.id})})}).catch(function(t){console.log(t)})},getSupplyList:function(){var t=this;this.form.supplierId="";var e={};this.supplierArr=[],e.firstCategoryId=this.form.firstCategoryId,e.secCategoryId=this.form.secCategoryId,e.brandId=this.form.brandId,e.url=m.b,e.pageSize=1e6,this.$axios.post(u.p,e).then(function(e){e.data.data.forEach(function(e,a){t.supplierArr.push({label:e.name,value:e.supplier_id})})}).catch(function(t){console.log(t)})},getFreightTemplate:function(){var t=this;this.freightTemplateArr=[],this.$axios.post(u.i,{url:m.b}).then(function(e){e.data.data.forEach(function(e,a){t.freightTemplateArr.push({label:e.name,value:e.id})})}).catch(function(t){console.log(t)})},getAllTags:function(){var t=this;this.tagArr=[],this.$axios.post(u.q,{url:m.b,type:2}).then(function(e){e.data.data.forEach(function(e,a){t.tagArr.push({label:e.name,value:e.id})}),t.tagArr.forEach(function(e,a){t.selectedTagArr.forEach(function(t,a){e.value==t.value&&(e.selected=!0)})})}).catch(function(t){console.log(t)})},getProductParam:function(t){var e=this;this.$axios.post(u.j,{categoryId:t}).then(function(t){e.productParam=[],t.data.data.forEach(function(t,a){t.parm_value="",e.productParam.push(t)})})}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"release-product"},[a("v-breadcrumb",{attrs:{nav:t.nav}}),t._v(" "),a("el-card",{attrs:{"body-style":{padding:"20px 45px",color:"#666"}}},[a("div",{staticClass:"pro-title"},[t._v("基本信息")]),t._v(" "),a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"产品名称"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{maxlength:16,placeholder:"请输入产品名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"产品图片"}},[a("draggable",{staticStyle:{display:"inline-block"},attrs:{move:t.getdata},on:{update:t.datadragEnd},model:{value:t.imgArr,callback:function(e){t.imgArr=e},expression:"imgArr"}},[a("transition-group",t._l(t.imgArr,function(e,r){return a("div",{key:r,staticClass:"img-wrap"},[a("div",{staticClass:"delImg",on:{click:function(a){t.deleteImg(e)}}},[a("icon",{attrs:{ico:"icon-shanchu"}})],1),t._v(" "),a("img",{staticClass:"uImg",attrs:{src:e.originUrl}})])}))],1),t._v(" "),a("el-upload",{staticClass:"img-uploader",attrs:{"before-upload":t.beforeUploadArr,action:t.uploadImg,"show-file-list":!1,"on-success":t.successUpload,disabled:t.isUseUpload,multiple:""}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),t._v(" "),a("div",{staticClass:"upload-tip"},[t._v("建议尺寸：800*800,拖拽图片可以改变顺序，第一张为默认头图")])],1),t._v(" "),a("el-form-item",{attrs:{label:"产品分类"}},[a("el-cascader",{attrs:{options:t.itemList,props:t.itemProps},on:{change:t.getProItemId},model:{value:t.categoryArr,callback:function(e){t.categoryArr=e},expression:"categoryArr"}}),t._v(" "),a("span",{staticStyle:{"margin-left":"30px"}},[t._v("产品品牌")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.getSupplyList},model:{value:t.form.brandId,callback:function(e){t.$set(t.form,"brandId",e)},expression:"form.brandId"}},t._l(t.brandArr,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"供应商"}},[a("el-select",{attrs:{placeholder:"下拉搜索供应商"},model:{value:t.form.supplierId,callback:function(e){t.$set(t.form,"supplierId",e)},expression:"form.supplierId"}},t._l(t.supplierArr,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"发货方"}},[a("el-select",{attrs:{placeholder:"选择发货方"},model:{value:t.form.sendfrom,callback:function(e){t.$set(t.form,"sendfrom",e)},expression:"form.sendfrom"}},t._l(t.shipperArr,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"产品重量"}},[a("el-input",{staticClass:"pro-weight",model:{value:t.form.weight,callback:function(e){t.$set(t.form,"weight",e)},expression:"form.weight"}}),t._v("kg\n          ")],1),t._v(" "),a("el-form-item",{attrs:{label:"产品体积"}},[a("el-input",{staticClass:"pro-weight",model:{value:t.form.volume,callback:function(e){t.$set(t.form,"volume",e)},expression:"form.volume"}}),t._v("m³\n          ")],1),t._v(" "),a("el-form-item",{attrs:{label:"产品参数"}},[a("div",{staticClass:"product-param"},[0==t.productParam.length?a("span",[t._v("暂无数据")]):t._l(t.productParam,function(e,r){return a("span",{key:r},[t._v(t._s(e.parm)+"："),a("el-input",{staticClass:"inp-param",model:{value:e.parm_value,callback:function(a){t.$set(e,"parm_value",a)},expression:"v.parm_value"}})],1)})],2)]),t._v(" "),a("div",{staticClass:"pro-title"},[t._v("基本信息")]),t._v(" "),a("el-form-item",{attrs:{label:"选择运费模板"}},[a("el-select",{attrs:{placeholder:"请选择模板"},model:{value:t.form.freightTemplateId,callback:function(e){t.$set(t.form,"freightTemplateId",e)},expression:"form.freightTemplateId"}},t._l(t.freightTemplateArr,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"售后周期"}},[a("transition",{attrs:{name:"fade"}},[t.showSaleTime?t._e():a("el-select",{attrs:{placeholder:"请选择售后周期"},model:{value:t.form.aferServiceDays,callback:function(e){t.$set(t.form,"aferServiceDays",e)},expression:"form.aferServiceDays"}},t._l(t.aferServiceDays,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),t._v(" "),t.showSaleTime?a("el-input",{staticStyle:{width:"215px"},attrs:{placeholder:"请输入售后周期"},model:{value:t.form.aferServiceDays,callback:function(e){t.$set(t.form,"aferServiceDays",e)},expression:"form.aferServiceDays"}}):t._e()],1),t._v(" "),a("el-button",{on:{click:t.defSaleTime}},[t._v("自定义")])],1),t._v(" "),a("div",{staticClass:"pro-title"},[t._v("产品信息")]),t._v(" "),a("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},on:{change:function(e){t.onEditorChange(e)}},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}}),t._v(" "),a("el-upload",{ref:"upload",staticStyle:{display:"none"},attrs:{action:t.qnLocation,data:t.uploadData,"on-success":t.upScuccess}},[a("el-button",{attrs:{size:"small",type:"primary",id:"imgInput","element-loading-text":"插入中,请稍候"}},[t._v("点击上传")])],1),t._v(" "),a("div",{staticClass:"selected-tag"},[0==t.selectedTagArr.length?a("span",{staticClass:"tag-tip"},[t._v("请选择标签")]):t._e(),t._v(" "),t._l(t.selectedTagArr,function(e,r){return a("el-tag",{key:r,staticClass:"tag",attrs:{type:"info",closable:""},on:{close:function(a){t.handleClose(r,e)}}},[t._v(t._s(e.label))])})],2),t._v(" "),a("div",{staticClass:"add-tag"},[a("el-input",{staticStyle:{width:"215px","margin-right":"20px"},attrs:{placeholder:"请输入标签/至多可添加20个"},model:{value:t.tagName,callback:function(e){t.tagName=e},expression:"tagName"}}),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.addTag}},[t._v("添加标签")])],1),t._v(" "),a("div",{staticClass:"tag-list"},[0==t.tagArr.length?a("span",{staticClass:"tag-tip"},[t._v("请添加标签")]):t._e(),t._v(" "),t._l(t.tagArr,function(e,r){return a("el-button",{key:r,class:{"selected-btn":e.selected},staticStyle:{"margin-bottom":"10px"},attrs:{disabled:e.selected},on:{click:function(a){t.insertTag(e)}}},[t._v(t._s(e.label))])})],2),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("确认发布")])],1)],1)],1)},staticRenderFns:[]};var v=a("VU/8")(g,h,!1,function(t){a("8xmp")},null,null);e.default=v.exports}});